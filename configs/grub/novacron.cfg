# NovaCron GRUB Configuration for Hypervisor Performance
# Ubuntu 24.04 LTS - Boot parameters for optimal virtualization

# =============================================================================
# GRUB CONFIGURATION FOR NOVACRON HYPERVISOR
# =============================================================================

# This file contains GRUB boot parameters optimized for NovaCron hypervisor
# performance. These parameters should be added to GRUB_CMDLINE_LINUX_DEFAULT
# in /etc/default/grub

# =============================================================================
# COMPLETE GRUB COMMAND LINE (for copy-paste)
# =============================================================================

GRUB_CMDLINE_LINUX_DEFAULT="quiet splash cpufreq.default_governor=performance isolcpus=2-7 nohz_full=2-7 rcu_nocbs=2-7 sched_autogroup_enabled=0 default_hugepagesz=2M hugepagesz=2M hugepages=2048 transparent_hugepage=madvise numa_balancing=enable elevator=mq-deadline kvm.nested=1 kvm_intel.nested=1 kvm_intel.enable_shadow_vmcs=1 kvm_intel.enable_apicv=1 kvm_intel.ept=1 kvm_amd.nested=1 iommu=pt processor.max_cstate=1 intel_idle.max_cstate=0 intel_pstate=disable mitigations=off nmi_watchdog=0 memtest=0"

# =============================================================================
# PARAMETER BREAKDOWN WITH EXPLANATIONS
# =============================================================================

# Basic boot parameters
# - quiet: Reduce boot messages for faster boot
# - splash: Show boot splash screen

# CPU Performance Optimizations
# - cpufreq.default_governor=performance: Lock CPU to maximum frequency
# - isolcpus=2-7: Reserve cores 2-7 exclusively for VM workloads  
# - nohz_full=2-7: Disable timer ticks on isolated cores
# - rcu_nocbs=2-7: Disable RCU callbacks on isolated cores
# - sched_autogroup_enabled=0: Disable automatic process grouping

# Memory Optimizations  
# - default_hugepagesz=2M: Set default huge page size to 2MB
# - hugepagesz=2M: Configure 2MB huge pages
# - hugepages=2048: Reserve 2048 huge pages (4GB total)
# - transparent_hugepage=madvise: Enable THP only when requested
# - numa_balancing=enable: Enable NUMA-aware memory allocation

# I/O Optimizations
# - elevator=mq-deadline: Use multi-queue deadline I/O scheduler

# Virtualization Features
# - kvm.nested=1: Enable nested virtualization
# - kvm_intel.nested=1: Intel nested virtualization
# - kvm_intel.enable_shadow_vmcs=1: Intel VMCS shadowing
# - kvm_intel.enable_apicv=1: Intel APIC virtualization
# - kvm_intel.ept=1: Intel Extended Page Tables
# - kvm_amd.nested=1: AMD nested virtualization
# - iommu=pt: IOMMU passthrough mode for device assignment

# Power Management
# - processor.max_cstate=1: Limit CPU sleep states for lower latency
# - intel_idle.max_cstate=0: Disable Intel idle driver deep states
# - intel_pstate=disable: Disable Intel P-state driver

# Security/Performance Trade-off (CAUTION)
# - mitigations=off: Disable CPU vulnerability mitigations
#   WARNING: Only use in trusted environments!

# Debugging and Monitoring
# - nmi_watchdog=0: Disable NMI watchdog for better performance
# - memtest=0: Skip memory test during boot

# =============================================================================
# ALTERNATIVE CONFIGURATIONS
# =============================================================================

# For PRODUCTION environments with security enabled:
GRUB_CMDLINE_LINUX_DEFAULT_SECURE="quiet splash cpufreq.default_governor=performance isolcpus=2-7 nohz_full=2-7 rcu_nocbs=2-7 default_hugepagesz=2M hugepagesz=2M hugepages=2048 transparent_hugepage=madvise numa_balancing=enable elevator=mq-deadline kvm.nested=1 kvm_intel.nested=1 kvm_intel.ept=1 kvm_amd.nested=1 iommu=pt processor.max_cstate=1 mitigations=auto nmi_watchdog=0"

# For DEVELOPMENT environments with debugging:
GRUB_CMDLINE_LINUX_DEFAULT_DEBUG="splash cpufreq.default_governor=performance isolcpus=2-7 nohz_full=2-7 rcu_nocbs=2-7 default_hugepagesz=2M hugepagesz=2M hugepages=1024 transparent_hugepage=madvise elevator=mq-deadline kvm.nested=1 kvm_intel.nested=1 kvm_amd.nested=1 iommu=pt mitigations=auto"

# For MINIMAL resource systems (reduce huge pages):
GRUB_CMDLINE_LINUX_DEFAULT_MINIMAL="quiet splash cpufreq.default_governor=performance isolcpus=1-3 nohz_full=1-3 rcu_nocbs=1-3 default_hugepagesz=2M hugepagesz=2M hugepages=512 elevator=mq-deadline kvm.nested=1 processor.max_cstate=1 nmi_watchdog=0"

# =============================================================================
# ESTIMATED PERFORMANCE IMPACT PER PARAMETER
# =============================================================================
#
# High Impact (>15% improvement):
# - isolcpus + nohz_full + rcu_nocbs: 20-30% VM CPU consistency
# - hugepages configuration: 15-25% memory performance
# - elevator=mq-deadline: 20-30% I/O latency improvement
# - mitigations=off: 10-20% CPU performance (security trade-off)
#
# Medium Impact (5-15% improvement):
# - cpufreq.default_governor=performance: 5-15% CPU performance
# - transparent_hugepage=madvise: 8-12% memory efficiency
# - processor.max_cstate=1: 10-15% latency reduction
# - kvm optimizations: 5-10% virtualization overhead reduction
#
# Low Impact (1-5% improvement):
# - sched_autogroup_enabled=0: 2-5% scheduling efficiency
# - numa_balancing=enable: 5-15% on NUMA systems only
# - nmi_watchdog=0: 1-3% CPU overhead reduction
#
# =============================================================================
# INSTALLATION INSTRUCTIONS
# =============================================================================
#
# 1. Backup current GRUB configuration:
#    sudo cp /etc/default/grub /etc/default/grub.backup
#
# 2. Edit GRUB configuration:
#    sudo nano /etc/default/grub
#
# 3. Replace GRUB_CMDLINE_LINUX_DEFAULT with desired configuration above
#
# 4. Update GRUB:
#    sudo update-grub
#
# 5. Reboot system:
#    sudo reboot
#
# 6. Verify parameters are active:
#    cat /proc/cmdline
#
# =============================================================================