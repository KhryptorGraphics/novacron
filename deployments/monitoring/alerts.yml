groups:
- name: dwcp-v3-alerts
  interval: 30s
  rules:
  # Critical Alerts
  - alert: ServiceDown
    expr: up{job="dwcp-v3"} == 0
    for: 2m
    labels:
      severity: critical
      component: dwcp-v3
    annotations:
      summary: "DWCP v3 service is down"
      description: "DWCP v3 service has been down for more than 2 minutes"

  - alert: HighErrorRate
    expr: rate(dwcp_errors_total[5m]) > 0.05
    for: 5m
    labels:
      severity: critical
      component: dwcp-v3
    annotations:
      summary: "High error rate detected"
      description: "Error rate is {{ $value | humanizePercentage }} (threshold: 5%)"

  # Warning Alerts
  - alert: HighLatency
    expr: histogram_quantile(0.95, rate(dwcp_latency_seconds_bucket[5m])) > 1.0
    for: 5m
    labels:
      severity: warning
      component: dwcp-v3
    annotations:
      summary: "High latency detected"
      description: "P95 latency is {{ $value }}s (threshold: 1s)"

  - alert: LowThroughput
    expr: rate(dwcp_bytes_transferred_total[5m]) < 1048576
    for: 10m
    labels:
      severity: warning
      component: dwcp-v3
    annotations:
      summary: "Low throughput detected"
      description: "Throughput is {{ $value | humanize }}B/s (threshold: 1MB/s)"

  - alert: HighMemoryUsage
    expr: (process_resident_memory_bytes{job="dwcp-v3"} / 1073741824) > 1.8
    for: 5m
    labels:
      severity: warning
      component: dwcp-v3
    annotations:
      summary: "High memory usage"
      description: "Memory usage is {{ $value | humanize }}B (threshold: 1.8GB)"

  - alert: RedisDown
    expr: up{job="redis"} == 0
    for: 2m
    labels:
      severity: critical
      component: redis
    annotations:
      summary: "Redis is down"
      description: "Redis service has been down for more than 2 minutes"

  - alert: NoActiveConnections
    expr: dwcp_active_connections == 0
    for: 10m
    labels:
      severity: warning
      component: dwcp-v3
    annotations:
      summary: "No active connections"
      description: "No active DWCP connections for the last 10 minutes"
