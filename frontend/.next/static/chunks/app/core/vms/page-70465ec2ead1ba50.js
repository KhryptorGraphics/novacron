(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8465],{62898:function(t,e,s){"use strict";s.d(e,{Z:function(){return r}});var i=s(2265),a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const r=(t,e)=>{const s=(0,i.forwardRef)((({color:s="currentColor",size:r=24,strokeWidth:n=2,absoluteStrokeWidth:o,children:l,...u},c)=>{return(0,i.createElement)("svg",{ref:c,...a,width:r,height:r,stroke:s,strokeWidth:o?24*Number(n)/Number(r):n,className:`lucide lucide-${d=t,d.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,...u},[...e.map((([t,e])=>(0,i.createElement)(t,e))),...(Array.isArray(l)?l:[l])||[]]);var d}));return s.displayName=`${t}`,s}},62442:function(t,e,s){"use strict";s.d(e,{Z:function(){return i}});const i=(0,s(62898).Z)("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]])},56111:function(t,e,s){Promise.resolve().then(s.bind(s,93825))},93825:function(t,e,s){"use strict";s.r(e),s.d(e,{default:function(){return j},dynamic:function(){return y}});var i=s(57437),a=s(2265),r=s(80651),n=s(58100);async function o(t,e,s){return(0,n.cD)(t,e,{role:s})}var l=s(70165),u=s(55764),c=s(37177),d=s(86582),h=s(41735),v=s(45271),m=s(61396),p=s.n(m),x=s(40150),f=s(3089),g=s(10609),b=s(59404);const y="force-dynamic";function j(){const[t,e]=(0,a.useState)(""),[s,n]=(0,a.useState)(""),[m,y]=(0,a.useState)(null),[j,w]=(0,a.useState)("viewer"),[S,C]=(0,a.useState)(1),[R,N]=(0,a.useState)(10);(0,a.useEffect)((()=>{C(1)}),[t,s]);const{items:k,pagination:M,isLoading:P,error:O}=(0,r.v)({page:S,pageSize:R,q:t,state:s||void 0}),{toast:E}=(0,b.p)();(0,a.useEffect)((()=>{const t=(0,c.c)((t=>y(t)));return()=>t.close()}),[]),(0,a.useEffect)((()=>{try{const t=localStorage.getItem("coreRole");"viewer"!==t&&"operator"!==t||w(t)}catch(t){}}),[]),(0,a.useEffect)((()=>{try{localStorage.setItem("coreRole",j)}catch(t){}}),[j]);const z=t=>{switch(t){case"running":return"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400";case"stopped":default:return"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-400";case"paused":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400"}},V=(0,l.NL)(),T=(0,u.D)({mutationFn:t=>o(t,"start",j),onSuccess:async()=>{E({title:"Start requested",description:"VM start action submitted"}),await Promise.all([V.invalidateQueries({queryKey:["vms"]})])},onError:t=>{var e;E({title:"Start failed",description:String(null!==(e=null===t||void 0===t?void 0:t.message)&&void 0!==e?e:t),variant:"destructive"})}}),q=(0,u.D)({mutationFn:t=>o(t,"stop",j),onSuccess:async()=>{E({title:"Stop requested",description:"VM stop action submitted"}),await Promise.all([V.invalidateQueries({queryKey:["vms"]})])},onError:t=>{var e;E({title:"Stop failed",description:String(null!==(e=null===t||void 0===t?void 0:t.message)&&void 0!==e?e:t),variant:"destructive"})}}),A=(0,u.D)({mutationFn:t=>o(t,"restart",j),onSuccess:async()=>{E({title:"Restart requested",description:"VM restart action submitted"}),await Promise.all([V.invalidateQueries({queryKey:["vms"]})])},onError:t=>{var e;E({title:"Restart failed",description:String(null!==(e=null===t||void 0===t?void 0:t.message)&&void 0!==e?e:t),variant:"destructive"})}}),F=(0,u.D)({mutationFn:t=>o(t,"pause",j),onSuccess:async()=>{E({title:"Pause requested",description:"VM pause action submitted"}),await Promise.all([V.invalidateQueries({queryKey:["vms"]})])},onError:t=>{var e;E({title:"Pause failed",description:String(null!==(e=null===t||void 0===t?void 0:t.message)&&void 0!==e?e:t),variant:"destructive"})}}),Q=(0,u.D)({mutationFn:t=>o(t,"resume",j),onSuccess:async()=>{E({title:"Resume requested",description:"VM resume action submitted"}),await Promise.all([V.invalidateQueries({queryKey:["vms"]})])},onError:t=>{var e;E({title:"Resume failed",description:String(null!==(e=null===t||void 0===t?void 0:t.message)&&void 0!==e?e:t),variant:"destructive"})}}),D="operator"!==j;var L,_,G,I,K;return(0,i.jsx)("div",{className:"container mx-auto p-6 space-y-6",children:(0,i.jsxs)(g.Zb,{children:[(0,i.jsxs)(g.Ol,{children:[(0,i.jsx)(g.ll,{children:"Core VMs"}),(0,i.jsxs)(g.SZ,{children:[P?"Loading...":O?"Error loading":"".concat(Array.isArray(k)?k.length:0," items")," "," ",m?"\u2014 WS welcome: ".concat(JSON.stringify(m)):null]})]}),(0,i.jsxs)(g.aY,{children:[(0,i.jsxs)("div",{className:"flex flex-wrap gap-3 mb-3 items-center",children:[(0,i.jsx)(d.I,{placeholder:"Search (q)",value:t,onChange:t=>e(t.target.value),className:"w-64"}),(0,i.jsxs)(h.Ph,{value:s,onValueChange:n,children:[(0,i.jsx)(h.i4,{className:"w-40",children:(0,i.jsx)(h.ki,{placeholder:"State"})}),(0,i.jsxs)(h.Bw,{children:[(0,i.jsx)(h.Ql,{value:"",children:"All"}),(0,i.jsx)(h.Ql,{value:"running",children:"Running"}),(0,i.jsx)(h.Ql,{value:"stopped",children:"Stopped"}),(0,i.jsx)(h.Ql,{value:"paused",children:"Paused"})]})]}),(0,i.jsxs)(h.Ph,{value:String(R),onValueChange:t=>N(Number(t)),children:[(0,i.jsx)(h.i4,{className:"w-32",children:(0,i.jsx)(h.ki,{placeholder:"Page size"})}),(0,i.jsx)(h.Bw,{children:[10,20,50,100].map((t=>(0,i.jsxs)(h.Ql,{value:String(t),children:[t," / page"]},t)))})]}),(0,i.jsxs)(h.Ph,{value:j,onValueChange:t=>w(t),children:[(0,i.jsx)(h.i4,{className:"w-40",children:(0,i.jsx)(h.ki,{placeholder:"Role"})}),(0,i.jsxs)(h.Bw,{children:[(0,i.jsx)(h.Ql,{value:"viewer",children:"viewer"}),(0,i.jsx)(h.Ql,{value:"operator",children:"operator"})]})]})]}),O?(0,i.jsx)("div",{className:"text-sm text-red-500",children:"Failed to load VMs"}):!k||0===k.length&&!P?(0,i.jsx)("div",{className:"text-sm text-muted-foreground",children:"No VMs found."}):(0,i.jsxs)(v.iA,{children:[(0,i.jsx)(v.xD,{children:(0,i.jsxs)(v.SC,{children:[(0,i.jsx)(v.ss,{children:"ID"}),(0,i.jsx)(v.ss,{children:"Name"}),(0,i.jsx)(v.ss,{children:"State"}),(0,i.jsx)(v.ss,{children:"Node"}),(0,i.jsx)(v.ss,{children:"Created"}),(0,i.jsx)(v.ss,{children:"Updated"}),(0,i.jsx)(v.ss,{className:"text-right",children:"Actions"})]})}),(0,i.jsx)(v.RM,{children:Array.isArray(k)&&k.map((t=>{var e;return(0,i.jsxs)(v.SC,{children:[(0,i.jsx)(v.pj,{className:"font-mono text-xs",children:(0,i.jsx)(p(),{href:"/core/vms/".concat(t.id),"aria-label":"View ".concat(t.name," details"),className:"underline underline-offset-4",children:t.id})}),(0,i.jsx)(v.pj,{children:(0,i.jsx)(p(),{href:"/core/vms/".concat(t.id),"aria-label":"View ".concat(t.name," details"),className:"hover:underline",children:t.name})}),(0,i.jsx)(v.pj,{children:(0,i.jsx)(x.C,{className:z(t.state),children:t.state})}),(0,i.jsx)(v.pj,{children:null!==(e=t.node_id)&&void 0!==e?e:"-"}),(0,i.jsx)(v.pj,{children:t.created_at}),(0,i.jsx)(v.pj,{children:t.updated_at}),(0,i.jsxs)(v.pj,{className:"text-right space-x-2",children:[(0,i.jsx)(f.z,{size:"sm",variant:"secondary",onClick:()=>T.mutate(t.id),disabled:D||T.isPending,children:"Start"}),(0,i.jsx)(f.z,{size:"sm",variant:"secondary",onClick:()=>q.mutate(t.id),disabled:D||q.isPending,children:"Stop"}),(0,i.jsx)(f.z,{size:"sm",variant:"secondary",onClick:()=>A.mutate(t.id),disabled:D||A.isPending,children:"Restart"}),(0,i.jsx)(f.z,{size:"sm",variant:"secondary",onClick:()=>F.mutate(t.id),disabled:D||F.isPending,children:"Pause"}),(0,i.jsx)(f.z,{size:"sm",variant:"secondary",onClick:()=>Q.mutate(t.id),disabled:D||Q.isPending,children:"Resume"})]})]},t.id)}))})]}),(0,i.jsxs)("div",{className:"flex items-center justify-between mt-3",children:[(0,i.jsxs)("div",{className:"text-sm text-muted-foreground",children:["page=",null!==(L=null===M||void 0===M?void 0:M.page)&&void 0!==L?L:S," pageSize=",null!==(_=null===M||void 0===M?void 0:M.pageSize)&&void 0!==_?_:R," total=",null!==(G=null===M||void 0===M?void 0:M.total)&&void 0!==G?G:"-"," totalPages=",null!==(I=null===M||void 0===M?void 0:M.totalPages)&&void 0!==I?I:"-"]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)(f.z,{size:"sm",variant:"outline",onClick:()=>C((t=>Math.max(1,t-1))),disabled:P||(null!==(K=null===M||void 0===M?void 0:M.page)&&void 0!==K?K:S)<=1,children:"Prev"}),(0,i.jsx)(f.z,{size:"sm",variant:"outline",onClick:()=>C((t=>t+1)),disabled:P||!(!M||!M.totalPages)&&M.page>=M.totalPages,children:"Next"})]})]})]})]})})}},59404:function(t,e,s){"use strict";s.d(e,{p:function(){return r}});var i=s(57437),a=s(5925);function r(){return{toast:t=>{const{title:e,description:s,variant:r="default",duration:n=4e3}=t,o=(0,i.jsxs)("div",{className:"grid gap-1",children:[e&&(0,i.jsx)("div",{className:"text-sm font-semibold",children:e}),s&&(0,i.jsx)("div",{className:"text-sm opacity-90",children:s})]});"destructive"===r?a.toast.error(o,{duration:n}):a.toast.success(o,{duration:n})}}}},58810:function(t,e,s){"use strict";s.d(e,{_:function(){return i}});const i=console},20172:function(t,e,s){"use strict";s.d(e,{R:function(){return l},m:function(){return o}});var i=s(58810),a=s(17156),r=s(11909),n=s(43238);class o extends r.F{constructor(t){super(),this.defaultOptions=t.defaultOptions,this.mutationId=t.mutationId,this.mutationCache=t.mutationCache,this.logger=t.logger||i._,this.observers=[],this.state=t.state||l(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options={...this.defaultOptions,...t},this.updateCacheTime(this.options.cacheTime)}get meta(){return this.options.meta}setState(t){this.dispatch({type:"setState",state:t})}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),this.mutationCache.notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){this.observers=this.observers.filter((e=>e!==t)),this.scheduleGc(),this.mutationCache.notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){this.observers.length||("loading"===this.state.status?this.scheduleGc():this.mutationCache.remove(this))}continue(){var t,e;return null!=(t=null==(e=this.retryer)?void 0:e.continue())?t:this.execute()}async execute(){const t=()=>{var t;return this.retryer=(0,n.Mz)({fn:()=>this.options.mutationFn?this.options.mutationFn(this.state.variables):Promise.reject("No mutationFn found"),onFail:(t,e)=>{this.dispatch({type:"failed",failureCount:t,error:e})},onPause:()=>{this.dispatch({type:"pause"})},onContinue:()=>{this.dispatch({type:"continue"})},retry:null!=(t=this.options.retry)?t:0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode}),this.retryer.promise},e="loading"===this.state.status;try{var s,i,a,r,o,l,u,c;if(!e){var d,h,v,m;this.dispatch({type:"loading",variables:this.options.variables}),await(null==(d=(h=this.mutationCache.config).onMutate)?void 0:d.call(h,this.state.variables,this));const t=await(null==(v=(m=this.options).onMutate)?void 0:v.call(m,this.state.variables));t!==this.state.context&&this.dispatch({type:"loading",context:t,variables:this.state.variables})}const n=await t();return await(null==(s=(i=this.mutationCache.config).onSuccess)?void 0:s.call(i,n,this.state.variables,this.state.context,this)),await(null==(a=(r=this.options).onSuccess)?void 0:a.call(r,n,this.state.variables,this.state.context)),await(null==(o=(l=this.mutationCache.config).onSettled)?void 0:o.call(l,n,null,this.state.variables,this.state.context,this)),await(null==(u=(c=this.options).onSettled)?void 0:u.call(c,n,null,this.state.variables,this.state.context)),this.dispatch({type:"success",data:n}),n}catch(S){try{var p,x,f,g,b,y,j,w;throw await(null==(p=(x=this.mutationCache.config).onError)?void 0:p.call(x,S,this.state.variables,this.state.context,this)),await(null==(f=(g=this.options).onError)?void 0:f.call(g,S,this.state.variables,this.state.context)),await(null==(b=(y=this.mutationCache.config).onSettled)?void 0:b.call(y,void 0,S,this.state.variables,this.state.context,this)),await(null==(j=(w=this.options).onSettled)?void 0:j.call(w,void 0,S,this.state.variables,this.state.context)),S}finally{this.dispatch({type:"error",error:S})}}}dispatch(t){this.state=(e=>{switch(t.type){case"failed":return{...e,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...e,isPaused:!0};case"continue":return{...e,isPaused:!1};case"loading":return{...e,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:!(0,n.Kw)(this.options.networkMode),status:"loading",variables:t.variables};case"success":return{...e,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...e,data:void 0,error:t.error,failureCount:e.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"};case"setState":return{...e,...t.state}}})(this.state),a.V.batch((()=>{this.observers.forEach((e=>{e.onMutationUpdate(t)})),this.mutationCache.notify({mutation:this,type:"updated",action:t})}))}}function l(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0}}},11909:function(t,e,s){"use strict";s.d(e,{F:function(){return a}});var i=s(46504);class a{destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),(0,i.PN)(this.cacheTime)&&(this.gcTimeout=setTimeout((()=>{this.optionalRemove()}),this.cacheTime))}updateCacheTime(t){this.cacheTime=Math.max(this.cacheTime||0,null!=t?t:i.sk?1/0:3e5)}clearGcTimeout(){this.gcTimeout&&(clearTimeout(this.gcTimeout),this.gcTimeout=void 0)}}},55764:function(t,e,s){"use strict";s.d(e,{D:function(){return h}});var i=s(2265),a=s(46504),r=s(20172),n=s(17156),o=s(29492);class l extends o.l{constructor(t,e){super(),this.client=t,this.setOptions(e),this.bindMethods(),this.updateResult()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var e;const s=this.options;this.options=this.client.defaultMutationOptions(t),(0,a.VS)(s,this.options)||this.client.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.currentMutation,observer:this}),null==(e=this.currentMutation)||e.setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(null==(t=this.currentMutation)||t.removeObserver(this))}onMutationUpdate(t){this.updateResult();const e={listeners:!0};"success"===t.type?e.onSuccess=!0:"error"===t.type&&(e.onError=!0),this.notify(e)}getCurrentResult(){return this.currentResult}reset(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})}mutate(t,e){return this.mutateOptions=e,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,{...this.options,variables:"undefined"!==typeof t?t:this.options.variables}),this.currentMutation.addObserver(this),this.currentMutation.execute()}updateResult(){const t=this.currentMutation?this.currentMutation.state:(0,r.R)(),e="loading"===t.status,s={...t,isLoading:e,isPending:e,isSuccess:"success"===t.status,isError:"error"===t.status,isIdle:"idle"===t.status,mutate:this.mutate,reset:this.reset};this.currentResult=s}notify(t){n.V.batch((()=>{var e,s,i,a;if(this.mutateOptions&&this.hasListeners())if(t.onSuccess)null==(e=(s=this.mutateOptions).onSuccess)||e.call(s,this.currentResult.data,this.currentResult.variables,this.currentResult.context),null==(i=(a=this.mutateOptions).onSettled)||i.call(a,this.currentResult.data,null,this.currentResult.variables,this.currentResult.context);else if(t.onError){var r,n,o,l;null==(r=(n=this.mutateOptions).onError)||r.call(n,this.currentResult.error,this.currentResult.variables,this.currentResult.context),null==(o=(l=this.mutateOptions).onSettled)||o.call(l,void 0,this.currentResult.error,this.currentResult.variables,this.currentResult.context)}t.listeners&&this.listeners.forEach((({listener:t})=>{t(this.currentResult)}))}))}}var u=s(45321),c=s(70165),d=s(57798);function h(t,e,s){const r=(0,a.lV)(t,e,s),o=(0,c.NL)({context:r.context}),[h]=i.useState((()=>new l(o,r)));i.useEffect((()=>{h.setOptions(r)}),[h,r]);const m=(0,u.$)(i.useCallback((t=>h.subscribe(n.V.batchCalls(t))),[h]),(()=>h.getCurrentResult()),(()=>h.getCurrentResult())),p=i.useCallback(((t,e)=>{h.mutate(t,e).catch(v)}),[h]);if(m.error&&(0,d.L)(h.options.useErrorBoundary,[m.error]))throw m.error;return{...m,mutate:p,mutateAsync:m.mutate}}function v(){}}},function(t){t.O(0,[6991,3354,2649,3010,4874,6892,1703,2971,2472,1744],(function(){return e=56111,t(t.s=e);var e}));var e=t.O();_N_E=e}]);