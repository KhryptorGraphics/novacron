(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8465],{6111:function(e,t,s){Promise.resolve().then(s.bind(s,3825))},3825:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return N},dynamic:function(){return y}});var r=s(7437),a=s(2265),n=s(651),i=s(3257);async function l(e,t,s){return(0,i.cD)(e,t,{role:s})}var o=s(165),d=s(5764),c=s(7177),u=s(6582),m=s(1735),f=s(5271),p=s(1396),x=s.n(p),v=s(150),h=s(3089),g=s(609),j=s(9404);const y="force-dynamic";function N(){const[e,t]=(0,a.useState)(""),[s,i]=(0,a.useState)(""),[p,y]=(0,a.useState)(null),[N,b]=(0,a.useState)("viewer"),[w,S]=(0,a.useState)(1),[k,R]=(0,a.useState)(10);(0,a.useEffect)((()=>{S(1)}),[e,s]);const{items:P,pagination:C,isLoading:z,error:E}=(0,n.v)({page:w,pageSize:k,q:e,state:s||void 0}),{toast:_}=(0,j.p)();(0,a.useEffect)((()=>{const e=(0,c.c)((e=>y(e)));return()=>e.close()}),[]),(0,a.useEffect)((()=>{try{const e=localStorage.getItem("coreRole");"viewer"!==e&&"operator"!==e||b(e)}catch(e){}}),[]),(0,a.useEffect)((()=>{try{localStorage.setItem("coreRole",N)}catch(e){}}),[N]);const q=e=>{switch(e){case"running":return"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400";case"stopped":default:return"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-400";case"paused":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400"}},V=(0,o.NL)(),L=(0,d.D)({mutationFn:e=>l(e,"start",N),onSuccess:async()=>{_({title:"Start requested",description:"VM start action submitted"}),await Promise.all([V.invalidateQueries({queryKey:["vms"]})])},onError:e=>{var t;_({title:"Start failed",description:String(null!==(t=null===e||void 0===e?void 0:e.message)&&void 0!==t?t:e),variant:"destructive"})}}),Q=(0,d.D)({mutationFn:e=>l(e,"stop",N),onSuccess:async()=>{_({title:"Stop requested",description:"VM stop action submitted"}),await Promise.all([V.invalidateQueries({queryKey:["vms"]})])},onError:e=>{var t;_({title:"Stop failed",description:String(null!==(t=null===e||void 0===e?void 0:e.message)&&void 0!==t?t:e),variant:"destructive"})}}),A=(0,d.D)({mutationFn:e=>l(e,"restart",N),onSuccess:async()=>{_({title:"Restart requested",description:"VM restart action submitted"}),await Promise.all([V.invalidateQueries({queryKey:["vms"]})])},onError:e=>{var t;_({title:"Restart failed",description:String(null!==(t=null===e||void 0===e?void 0:e.message)&&void 0!==t?t:e),variant:"destructive"})}}),M=(0,d.D)({mutationFn:e=>l(e,"pause",N),onSuccess:async()=>{_({title:"Pause requested",description:"VM pause action submitted"}),await Promise.all([V.invalidateQueries({queryKey:["vms"]})])},onError:e=>{var t;_({title:"Pause failed",description:String(null!==(t=null===e||void 0===e?void 0:e.message)&&void 0!==t?t:e),variant:"destructive"})}}),T=(0,d.D)({mutationFn:e=>l(e,"resume",N),onSuccess:async()=>{_({title:"Resume requested",description:"VM resume action submitted"}),await Promise.all([V.invalidateQueries({queryKey:["vms"]})])},onError:e=>{var t;_({title:"Resume failed",description:String(null!==(t=null===e||void 0===e?void 0:e.message)&&void 0!==t?t:e),variant:"destructive"})}}),D="operator"!==N;var F,B,I,O,W;return(0,r.jsx)("div",{className:"container mx-auto p-6 space-y-6",children:(0,r.jsxs)(g.Zb,{children:[(0,r.jsxs)(g.Ol,{children:[(0,r.jsx)(g.ll,{children:"Core VMs"}),(0,r.jsxs)(g.SZ,{children:[z?"Loading...":E?"Error loading":"".concat(Array.isArray(P)?P.length:0," items")," "," ",p?"\u2014 WS welcome: ".concat(JSON.stringify(p)):null]})]}),(0,r.jsxs)(g.aY,{children:[(0,r.jsxs)("div",{className:"flex flex-wrap gap-3 mb-3 items-center",children:[(0,r.jsx)(u.I,{placeholder:"Search (q)",value:e,onChange:e=>t(e.target.value),className:"w-64"}),(0,r.jsxs)(m.Ph,{value:s,onValueChange:i,children:[(0,r.jsx)(m.i4,{className:"w-40",children:(0,r.jsx)(m.ki,{placeholder:"State"})}),(0,r.jsxs)(m.Bw,{children:[(0,r.jsx)(m.Ql,{value:"",children:"All"}),(0,r.jsx)(m.Ql,{value:"running",children:"Running"}),(0,r.jsx)(m.Ql,{value:"stopped",children:"Stopped"}),(0,r.jsx)(m.Ql,{value:"paused",children:"Paused"})]})]}),(0,r.jsxs)(m.Ph,{value:String(k),onValueChange:e=>R(Number(e)),children:[(0,r.jsx)(m.i4,{className:"w-32",children:(0,r.jsx)(m.ki,{placeholder:"Page size"})}),(0,r.jsx)(m.Bw,{children:[10,20,50,100].map((e=>(0,r.jsxs)(m.Ql,{value:String(e),children:[e," / page"]},e)))})]}),(0,r.jsxs)(m.Ph,{value:N,onValueChange:e=>b(e),children:[(0,r.jsx)(m.i4,{className:"w-40",children:(0,r.jsx)(m.ki,{placeholder:"Role"})}),(0,r.jsxs)(m.Bw,{children:[(0,r.jsx)(m.Ql,{value:"viewer",children:"viewer"}),(0,r.jsx)(m.Ql,{value:"operator",children:"operator"})]})]})]}),E?(0,r.jsx)("div",{className:"text-sm text-red-500",children:"Failed to load VMs"}):!P||0===P.length&&!z?(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"No VMs found."}):(0,r.jsxs)(f.iA,{children:[(0,r.jsx)(f.xD,{children:(0,r.jsxs)(f.SC,{children:[(0,r.jsx)(f.ss,{children:"ID"}),(0,r.jsx)(f.ss,{children:"Name"}),(0,r.jsx)(f.ss,{children:"State"}),(0,r.jsx)(f.ss,{children:"Node"}),(0,r.jsx)(f.ss,{children:"Created"}),(0,r.jsx)(f.ss,{children:"Updated"}),(0,r.jsx)(f.ss,{className:"text-right",children:"Actions"})]})}),(0,r.jsx)(f.RM,{children:Array.isArray(P)&&P.map((e=>{var t;return(0,r.jsxs)(f.SC,{children:[(0,r.jsx)(f.pj,{className:"font-mono text-xs",children:(0,r.jsx)(x(),{href:"/core/vms/".concat(e.id),"aria-label":"View ".concat(e.name," details"),className:"underline underline-offset-4",children:e.id})}),(0,r.jsx)(f.pj,{children:(0,r.jsx)(x(),{href:"/core/vms/".concat(e.id),"aria-label":"View ".concat(e.name," details"),className:"hover:underline",children:e.name})}),(0,r.jsx)(f.pj,{children:(0,r.jsx)(v.C,{className:q(e.state),children:e.state})}),(0,r.jsx)(f.pj,{children:null!==(t=e.node_id)&&void 0!==t?t:"-"}),(0,r.jsx)(f.pj,{children:e.created_at}),(0,r.jsx)(f.pj,{children:e.updated_at}),(0,r.jsxs)(f.pj,{className:"text-right space-x-2",children:[(0,r.jsx)(h.z,{size:"sm",variant:"secondary",onClick:()=>L.mutate(e.id),disabled:D||L.isPending,children:"Start"}),(0,r.jsx)(h.z,{size:"sm",variant:"secondary",onClick:()=>Q.mutate(e.id),disabled:D||Q.isPending,children:"Stop"}),(0,r.jsx)(h.z,{size:"sm",variant:"secondary",onClick:()=>A.mutate(e.id),disabled:D||A.isPending,children:"Restart"}),(0,r.jsx)(h.z,{size:"sm",variant:"secondary",onClick:()=>M.mutate(e.id),disabled:D||M.isPending,children:"Pause"}),(0,r.jsx)(h.z,{size:"sm",variant:"secondary",onClick:()=>T.mutate(e.id),disabled:D||T.isPending,children:"Resume"})]})]},e.id)}))})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between mt-3",children:[(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:["page=",null!==(F=null===C||void 0===C?void 0:C.page)&&void 0!==F?F:w," pageSize=",null!==(B=null===C||void 0===C?void 0:C.pageSize)&&void 0!==B?B:k," total=",null!==(I=null===C||void 0===C?void 0:C.total)&&void 0!==I?I:"-"," totalPages=",null!==(O=null===C||void 0===C?void 0:C.totalPages)&&void 0!==O?O:"-"]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(h.z,{size:"sm",variant:"outline",onClick:()=>S((e=>Math.max(1,e-1))),disabled:z||(null!==(W=null===C||void 0===C?void 0:C.page)&&void 0!==W?W:w)<=1,children:"Prev"}),(0,r.jsx)(h.z,{size:"sm",variant:"outline",onClick:()=>S((e=>e+1)),disabled:z||!(!C||!C.totalPages)&&C.page>=C.totalPages,children:"Next"})]})]})]})]})})}},6582:function(e,t,s){"use strict";s.d(t,{I:function(){return i}});var r=s(7437),a=s(2265),n=s(345);const i=a.forwardRef(((e,t)=>{let{className:s,type:a,...i}=e;return(0,r.jsx)("input",{type:a,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...i})}));i.displayName="Input"},1735:function(e,t,s){"use strict";s.d(t,{Bw:function(){return m},Ph:function(){return d},Ql:function(){return f},i4:function(){return u},ki:function(){return c}});var r=s(7437),a=s(2265),n=s(2544),i=s(3523),l=s(2442),o=s(345);const d=n.fC,c=(n.ZA,n.B4),u=a.forwardRef(((e,t)=>{let{className:s,children:a,...l}=e;return(0,r.jsxs)(n.xz,{ref:t,className:(0,o.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...l,children:[a,(0,r.jsx)(n.JO,{asChild:!0,children:(0,r.jsx)(i.Z,{className:"h-4 w-4 opacity-50"})})]})}));u.displayName=n.xz.displayName;const m=a.forwardRef(((e,t)=>{let{className:s,children:a,position:i="popper",...l}=e;return(0,r.jsx)(n.h_,{children:(0,r.jsx)(n.VY,{ref:t,className:(0,o.cn)("relative z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md animate-in fade-in-80","popper"===i&&"translate-y-1",s),position:i,...l,children:(0,r.jsx)(n.l_,{className:(0,o.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a})})})}));m.displayName=n.VY.displayName;a.forwardRef(((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.__,{ref:t,className:(0,o.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...a})})).displayName=n.__.displayName;const f=a.forwardRef(((e,t)=>{let{className:s,children:a,...i}=e;return(0,r.jsxs)(n.ck,{ref:t,className:(0,o.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...i,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(n.wU,{children:(0,r.jsx)(l.Z,{className:"h-4 w-4"})})}),(0,r.jsx)(n.eT,{children:a})]})}));f.displayName=n.ck.displayName;a.forwardRef(((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.Z0,{ref:t,className:(0,o.cn)("-mx-1 my-1 h-px bg-muted",s),...a})})).displayName=n.Z0.displayName},5271:function(e,t,s){"use strict";s.d(t,{RM:function(){return o},Rn:function(){return m},SC:function(){return d},iA:function(){return i},pj:function(){return u},ss:function(){return c},xD:function(){return l}});var r=s(7437),a=s(2265),n=s(345);const i=a.forwardRef(((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{className:"w-full overflow-auto",children:(0,r.jsx)("table",{ref:t,className:(0,n.cn)("w-full caption-bottom text-sm",s),...a})})}));i.displayName="Table";const l=a.forwardRef(((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("thead",{ref:t,className:(0,n.cn)("[&_tr]:border-b",s),...a})}));l.displayName="TableHeader";const o=a.forwardRef(((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("tbody",{ref:t,className:(0,n.cn)("[&_tr:last-child]:border-0",s),...a})}));o.displayName="TableBody";a.forwardRef(((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("tfoot",{ref:t,className:(0,n.cn)("bg-primary font-medium text-primary-foreground",s),...a})})).displayName="TableFooter";const d=a.forwardRef(((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("tr",{ref:t,className:(0,n.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...a})}));d.displayName="TableRow";const c=a.forwardRef(((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("th",{ref:t,className:(0,n.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...a})}));c.displayName="TableHead";const u=a.forwardRef(((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("td",{ref:t,className:(0,n.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...a})}));u.displayName="TableCell";const m=a.forwardRef(((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("caption",{ref:t,className:(0,n.cn)("mt-4 text-sm text-muted-foreground",s),...a})}));m.displayName="TableCaption"},651:function(e,t,s){"use strict";s.d(t,{v:function(){return n}});var r=s(4874),a=s(3257);function n(e){const{data:t,isLoading:s,error:n}=(0,r.a)({queryKey:["vms",e],queryFn:()=>(0,a.tq)(e),staleTime:5e3});return{items:Array.isArray(null===t||void 0===t?void 0:t.data)?t.data:[],pagination:(null===t||void 0===t?void 0:t.pagination)||{page:1,pageSize:10,total:0,totalPages:0},isLoading:s,error:n}}},7177:function(e,t,s){"use strict";s.d(t,{c:function(){return a}});const r=s(2601).env.NEXT_PUBLIC_WS_URL||"ws://localhost:8090/ws/events/v1";function a(e){try{const t=new WebSocket(r);let s=!0;return t.addEventListener("open",(()=>console.log("WS connected"))),t.addEventListener("error",(e=>console.warn("WS error:",e))),t.addEventListener("close",(()=>console.log("WS disconnected"))),t.addEventListener("message",(t=>{try{const r=JSON.parse(t.data);s&&(s=!1,null===e||void 0===e||e(r))}catch(r){}})),t}catch(t){return{close:()=>{},addEventListener:()=>{},removeEventListener:()=>{},send:()=>{},readyState:WebSocket.CLOSED}}}}},function(e){e.O(0,[2649,1411,6892,1529,7812,209,2971,2472,1744],(function(){return t=6111,e(e.s=t);var t}));var t=e.O();_N_E=t}]);