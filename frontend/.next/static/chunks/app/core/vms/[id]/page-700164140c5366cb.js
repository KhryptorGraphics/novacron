(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6964],{2785:function(e,i,r){Promise.resolve().then(r.bind(r,4684))},4684:function(e,i,r){"use strict";r.r(i),r.d(i,{default:function(){return g},dynamic:function(){return y}});var s=r(7437),t=r(1396),d=r.n(t),n=r(2265),a=r(4033),l=r(165),o=r(4874),c=r(3257);var u=r(5764);function v(e,i,r){const s=(0,l.NL)();return(0,u.D)({mutationKey:["vm-action",e,i,null===r||void 0===r?void 0:r.role],mutationFn:()=>(0,c.cD)(e,i,{role:null===r||void 0===r?void 0:r.role}),onMutate:async()=>{},onSuccess:async()=>{await Promise.all([s.invalidateQueries({queryKey:["vm",e]}),s.invalidateQueries({queryKey:["vms"]})])}})}var m=r(9404),x=r(150),h=r(3089),j=r(609);const y="force-dynamic";function g(){var e;const i=(0,a.useParams)(),r="string"===typeof(null===i||void 0===i?void 0:i.id)?i.id:Array.isArray(null===i||void 0===i?void 0:i.id)?null===i||void 0===i||null===(e=i.id)||void 0===e?void 0:e[0]:"",{vm:t,isLoading:u,error:y}=function(e){const{data:i,isLoading:r,error:s}=(0,o.a)({queryKey:["vm",e],queryFn:()=>(0,c.OC)(e),enabled:Boolean(e)});var t;return{vm:null!==(t=null===i||void 0===i?void 0:i.data)&&void 0!==t?t:null,isLoading:r,error:s}}(r),{toast:g}=(0,m.p)(),f=(0,l.NL)(),[p,S]=(0,n.useState)("viewer");(0,n.useEffect)((()=>{try{const e=localStorage.getItem("coreRole");"viewer"!==e&&"operator"!==e||S(e)}catch(e){}}),[]);const N="operator"!==p,q=v(r,"start",{role:p}),E=v(r,"stop",{role:p}),K=v(r,"restart",{role:p}),b=v(r,"pause",{role:p}),Q=v(r,"resume",{role:p});var k,P;return(0,n.useEffect)((()=>{q.isSuccess&&(g({title:"Start requested"}),f.invalidateQueries({queryKey:["vm",r]}),f.invalidateQueries({queryKey:["vms"]})),E.isSuccess&&(g({title:"Stop requested"}),f.invalidateQueries({queryKey:["vm",r]}),f.invalidateQueries({queryKey:["vms"]})),K.isSuccess&&(g({title:"Restart requested"}),f.invalidateQueries({queryKey:["vm",r]}),f.invalidateQueries({queryKey:["vms"]})),b.isSuccess&&(g({title:"Pause requested"}),f.invalidateQueries({queryKey:["vm",r]}),f.invalidateQueries({queryKey:["vms"]})),Q.isSuccess&&(g({title:"Resume requested"}),f.invalidateQueries({queryKey:["vm",r]}),f.invalidateQueries({queryKey:["vms"]}))}),[q.isSuccess,E.isSuccess,K.isSuccess,b.isSuccess,Q.isSuccess,r,g,f]),(0,n.useEffect)((()=>{var e,i,r,s,t,d,n,a,l,o;q.isError&&g({title:"Start failed",description:String(null!==(d=null===(e=q.error)||void 0===e?void 0:e.message)&&void 0!==d?d:q.error),variant:"destructive"}),E.isError&&g({title:"Stop failed",description:String(null!==(n=null===(i=E.error)||void 0===i?void 0:i.message)&&void 0!==n?n:E.error),variant:"destructive"}),K.isError&&g({title:"Restart failed",description:String(null!==(a=null===(r=K.error)||void 0===r?void 0:r.message)&&void 0!==a?a:K.error),variant:"destructive"}),b.isError&&g({title:"Pause failed",description:String(null!==(l=null===(s=b.error)||void 0===s?void 0:s.message)&&void 0!==l?l:b.error),variant:"destructive"}),Q.isError&&g({title:"Resume failed",description:String(null!==(o=null===(t=Q.error)||void 0===t?void 0:t.message)&&void 0!==o?o:Q.error),variant:"destructive"})}),[q.isError,E.isError,K.isError,b.isError,Q.isError,q.error,E.error,K.error,b.error,Q.error,g]),(0,s.jsx)("div",{className:"container mx-auto p-6 space-y-6",children:(0,s.jsxs)(j.Zb,{children:[(0,s.jsxs)(j.Ol,{children:[(0,s.jsx)(j.ll,{children:"VM Detail"}),(0,s.jsx)(j.SZ,{children:(0,s.jsx)(d(),{href:"/core/vms",className:"underline",children:"Back to list"})})]}),(0,s.jsx)(j.aY,{children:u?(0,s.jsx)("div",{children:"Loading VM..."}):y?(0,s.jsxs)("div",{className:"text-red-500",children:["Failed to load VM: ",String(null!==(k=null===y||void 0===y?void 0:y.message)&&void 0!==k?k:y)]}):t?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"ID"}),(0,s.jsx)("div",{className:"font-mono text-xs break-all",children:t.id}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"Name"}),(0,s.jsx)("div",{children:t.name})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"State"}),(0,s.jsx)("div",{children:(0,s.jsx)(x.C,{children:t.state})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"Node"}),(0,s.jsx)("div",{children:null!==(P=t.node_id)&&void 0!==P?P:"-"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"Created"}),(0,s.jsx)("div",{children:t.created_at})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"Updated"}),(0,s.jsx)("div",{children:t.updated_at})]})]}),"tags"in t&&t.tags?(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"Tags"}),(0,s.jsx)("ul",{className:"list-disc ml-6",children:Object.entries(t.tags).map((e=>{let[i,r]=e;return(0,s.jsxs)("li",{children:[(0,s.jsxs)("span",{className:"font-medium",children:[i,":"]})," ",r]},i)}))})]}):null,(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(h.z,{size:"sm",variant:"secondary",onClick:()=>q.mutate(),disabled:N||q.isPending,children:"Start"}),(0,s.jsx)(h.z,{size:"sm",variant:"secondary",onClick:()=>E.mutate(),disabled:N||E.isPending,children:"Stop"}),(0,s.jsx)(h.z,{size:"sm",variant:"secondary",onClick:()=>K.mutate(),disabled:N||K.isPending,children:"Restart"}),(0,s.jsx)(h.z,{size:"sm",variant:"secondary",onClick:()=>b.mutate(),disabled:N||b.isPending,children:"Pause"}),(0,s.jsx)(h.z,{size:"sm",variant:"secondary",onClick:()=>Q.mutate(),disabled:N||Q.isPending,children:"Resume"}),N&&(0,s.jsx)("div",{className:"text-xs text-muted-foreground self-center",children:"Switch to operator on the list page to enable actions"})]})]}):(0,s.jsx)("div",{children:"VM not found."})})]})})}},4033:function(e,i,r){e.exports=r(94)}},function(e){e.O(0,[2649,6892,1529,7812,209,2971,2472,1744],(function(){return i=2785,e(e.s=i);var i}));var i=e.O();_N_E=i}]);