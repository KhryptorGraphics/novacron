(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8352],{62601:function(e,t,r){"use strict";var n,s;e.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"===typeof(null==(s=r.g.process)?void 0:s.env)?r.g.process:r(58960)},70337:function(e,t,r){Promise.resolve().then(r.bind(r,89354))},89354:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return m}});var n=r(57437),s=r(2265),o=r(61396),a=r.n(o),i=r(24033),c=r(3089),u=r(86582),d=r(6429),l=r(10609),f=r(59404),h=r(50471);function m(){const[e,t]=(0,s.useState)("setup"),[r,o]=(0,s.useState)(!1),[m,p]=(0,s.useState)(!0),[g,v]=(0,s.useState)(""),[x,y]=(0,s.useState)(null),[b,w]=(0,s.useState)(""),[N,j]=(0,s.useState)(""),[T,S]=(0,s.useState)([]),_=(0,i.useRouter)(),{toast:k}=(0,f.p)();(0,s.useEffect)((()=>{(async()=>{try{if(!h.O.isAuthenticated())return void _.push("/auth/login");p(!0);const e=await h.O.setup2FA();w(e.qr_code),j(e.secret),S(e.backup_codes)}catch(x){console.error("Failed to initialize 2FA setup:",x),k({title:"Error",description:"Failed to initialize 2FA setup. Please try again.",variant:"destructive"}),w("https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=otpauth://totp/NovaCron:user@example.com?secret=JBSWY3DPEHPK3PXP&issuer=NovaCron"),j("JBSWY3DPEHPK3PXP"),S(["1a2b-3c4d","5e6f-7g8h","9i0j-1k2l","3m4n-5o6p","7q8r-9s0t","1u2v-3w4x"])}finally{p(!1)}})()}),[_,k]);return(0,n.jsx)("div",{className:"container relative min-h-screen flex-col items-center justify-center grid lg:max-w-none lg:px-0",children:(0,n.jsxs)("div",{className:"mx-auto flex w-full flex-col justify-center space-y-6 sm:w-[480px]",children:[(0,n.jsx)("div",{className:"flex justify-center mb-4",children:(0,n.jsx)(a(),{href:"/dashboard",className:"flex items-center gap-2 text-sm text-gray-600 hover:text-gray-900",children:"\u2190 Skip to Dashboard"})}),"setup"===e&&(0,n.jsxs)(l.Zb,{children:[(0,n.jsxs)(l.Ol,{children:[(0,n.jsx)(l.ll,{children:"Set Up Two-Factor Authentication"}),(0,n.jsx)(l.SZ,{children:"Scan the QR code with your authenticator app"})]}),(0,n.jsxs)(l.aY,{className:"space-y-4",children:[m?(0,n.jsx)("div",{className:"flex justify-center py-8",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"flex justify-center",children:(0,n.jsx)("img",{src:b,alt:"2FA QR Code",className:"w-48 h-48"})}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"Or enter this code manually:"}),(0,n.jsx)("code",{className:"bg-gray-100 px-3 py-1 rounded",children:N})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(d._,{children:"Backup Codes"}),(0,n.jsx)("div",{className:"grid grid-cols-2 gap-2",children:T.map(((e,t)=>(0,n.jsx)("code",{className:"bg-gray-100 px-2 py-1 rounded text-sm",children:e},t)))})]})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(c.z,{onClick:()=>t("verify"),className:"flex-1",disabled:m,children:"Continue to Verification"}),(0,n.jsx)(c.z,{onClick:()=>{_.push("/dashboard")},variant:"outline",disabled:m,children:"Skip"})]})]})]}),"verify"===e&&(0,n.jsxs)(l.Zb,{children:[(0,n.jsxs)(l.Ol,{children:[(0,n.jsx)(l.ll,{children:"Verify Your Setup"}),(0,n.jsx)(l.SZ,{children:"Enter the 6-digit code from your authenticator app"})]}),(0,n.jsx)(l.aY,{children:(0,n.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),g&&6===g.length){o(!0),y(null);try{const e=h.O.getCurrentUser();if(!e)throw new Error("User not authenticated");const r=await h.O.verify2FASetup({user_id:e.id,code:g});if(!r.valid)throw new Error(r.error||"Verification failed");await h.O.enable2FA(g),t("complete"),k({title:"Two-Factor Authentication Enabled",description:"Your account is now secured with 2FA"})}catch(x){console.error("2FA verification failed:",x);const t=x instanceof Error?x.message:"Invalid verification code. Please try again.";y(t)}finally{o(!1)}}else y("Please enter a 6-digit verification code")},className:"space-y-4",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(d._,{htmlFor:"code",children:"Verification Code"}),(0,n.jsx)(u.I,{id:"code",type:"text",placeholder:"000000",value:g,onChange:e=>v(e.target.value),maxLength:6,disabled:r}),x&&(0,n.jsx)("p",{className:"text-sm text-red-600",children:x})]}),(0,n.jsx)(c.z,{type:"submit",className:"w-full",disabled:r,children:r?"Verifying...":"Verify and Enable 2FA"})]})})]}),"complete"===e&&(0,n.jsxs)(l.Zb,{children:[(0,n.jsxs)(l.Ol,{children:[(0,n.jsx)(l.ll,{children:"Setup Complete!"}),(0,n.jsx)(l.SZ,{children:"Two-factor authentication has been enabled for your account"})]}),(0,n.jsx)(l.aY,{children:(0,n.jsxs)("div",{className:"text-center space-y-4",children:[(0,n.jsx)("div",{className:"text-green-600 text-6xl",children:"\u2713"}),(0,n.jsx)("p",{children:"Your account is now more secure"}),(0,n.jsx)(c.z,{onClick:()=>{_.push("/dashboard")},className:"w-full",children:"Continue to Dashboard"})]})})]})]})})}},3089:function(e,t,r){"use strict";r.d(t,{z:function(){return u}});var n=r(57437),s=r(2265),o=r(67256),a=r(96061),i=r(60345);const c=(0,a.j)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 active:scale-95",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-sm hover:shadow-md",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 shadow-sm hover:shadow-md",success:"bg-success text-success-foreground hover:bg-success/90 shadow-sm hover:shadow-md",warning:"bg-warning text-warning-foreground hover:bg-warning/90 shadow-sm hover:shadow-md",info:"bg-info text-info-foreground hover:bg-info/90 shadow-sm hover:shadow-md",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground hover:border-accent-foreground/20",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 shadow-sm",ghost:"hover:bg-accent hover:text-accent-foreground hover:scale-105",link:"text-primary underline-offset-4 hover:underline hover:text-primary/80",nova:"bg-gradient-to-r from-nova-500 to-nova-600 text-white hover:from-nova-600 hover:to-nova-700 shadow-md hover:shadow-lg"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),u=s.forwardRef(((e,t)=>{let{className:r,variant:s,size:a,asChild:u=!1,...d}=e;const l=u?o.g7:"button";return(0,n.jsx)(l,{className:(0,i.cn)(c({variant:s,size:a,className:r})),ref:t,...d})}));u.displayName="Button"},10609:function(e,t,r){"use strict";r.d(t,{Ol:function(){return i},SZ:function(){return u},Zb:function(){return a},aY:function(){return d},eW:function(){return l},ll:function(){return c}});var n=r(57437),s=r(2265),o=r(60345);const a=s.forwardRef(((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,o.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...s})}));a.displayName="Card";const i=s.forwardRef(((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,o.cn)("flex flex-col space-y-1.5 p-6",r),...s})}));i.displayName="CardHeader";const c=s.forwardRef(((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("h3",{ref:t,className:(0,o.cn)("text-2xl font-semibold leading-none tracking-tight",r),...s})}));c.displayName="CardTitle";const u=s.forwardRef(((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("p",{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",r),...s})}));u.displayName="CardDescription";const d=s.forwardRef(((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,o.cn)("p-6 pt-0",r),...s})}));d.displayName="CardContent";const l=s.forwardRef(((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,o.cn)("flex items-center p-6 pt-0",r),...s})}));l.displayName="CardFooter"},86582:function(e,t,r){"use strict";r.d(t,{I:function(){return a}});var n=r(57437),s=r(2265),o=r(60345);const a=s.forwardRef(((e,t)=>{let{className:r,type:s,...a}=e;return(0,n.jsx)("input",{type:s,className:(0,o.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...a})}));a.displayName="Input"},6429:function(e,t,r){"use strict";r.d(t,{_:function(){return u}});var n=r(57437),s=r(2265),o=r(36743),a=r(96061),i=r(60345);const c=(0,a.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),u=s.forwardRef(((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)(o.f,{ref:t,className:(0,i.cn)(c(),r),...s})}));u.displayName=o.f.displayName},59404:function(e,t,r){"use strict";r.d(t,{p:function(){return o}});var n=r(57437),s=r(5925);function o(){return{toast:e=>{const{title:t,description:r,variant:o="default",duration:a=4e3}=e,i=(0,n.jsxs)("div",{className:"grid gap-1",children:[t&&(0,n.jsx)("div",{className:"text-sm font-semibold",children:t}),r&&(0,n.jsx)("div",{className:"text-sm opacity-90",children:r})]});"destructive"===o?s.toast.error(i,{duration:a}):s.toast.success(i,{duration:a})}}}},50471:function(e,t,r){"use strict";r.d(t,{O:function(){return s}});const n=r(62601).env.NEXT_PUBLIC_API_URL||"http://localhost:8090";const s=new class{async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r="".concat(n).concat(e),s={headers:{"Content-Type":"application/json",...t.headers},...t};try{const e=await fetch(r,s);if(!e.ok)throw new Error("HTTP error! status: ".concat(e.status));return await e.json()}catch(o){throw console.error("API request failed for ".concat(e,":"),o),o}}async login(e){return this.request("/api/auth/login",{method:"POST",body:JSON.stringify(e)})}async register(e){return this.request("/api/auth/register",{method:"POST",body:JSON.stringify(e)})}async forgotPassword(e){return this.request("/api/auth/forgot-password",{method:"POST",body:JSON.stringify(e)})}async resetPassword(e){return this.request("/api/auth/reset-password",{method:"POST",body:JSON.stringify(e)})}decodeJWT(e){try{const t=e.split(".");if(3!==t.length)throw new Error("Invalid JWT format");const r=t[1],n=atob(r.replace(/-/g,"+").replace(/_/g,"/"));return JSON.parse(n)}catch(t){return console.error("Failed to decode JWT:",t),null}}getCurrentUser(){const e=this.getToken();if(!e)return null;try{const t=this.decodeJWT(e);if(!t)return this.removeToken(),null;if(t.exp&&1e3*t.exp<Date.now())return this.removeToken(),null;const r={id:t.sub||t.user_id||t.id,email:t.email||"",firstName:t.firstName||t.first_name||t.given_name||"",lastName:t.lastName||t.last_name||t.family_name||"",tenantId:t.tenantId||t.tenant_id,status:t.status||"active",two_factor_enabled:t.two_factor_enabled||t["2fa_enabled"]||!1};return localStorage.setItem("authUser",JSON.stringify(r)),r}catch(t){return console.error("Error getting current user:",t),this.removeToken(),null}}isAuthenticated(){return!!this.getToken()}getToken(){return localStorage.getItem("novacron_token")}setToken(e,t){localStorage.setItem("novacron_token",e),t&&localStorage.setItem("authUser",JSON.stringify(t))}removeToken(){localStorage.removeItem("novacron_token"),localStorage.removeItem("authUser"),localStorage.removeItem("tempToken")}logout(){this.removeToken()}async setup2FA(){const e=this.getToken(),t=this.getCurrentUser();if(!t)throw new Error("User not authenticated");return this.request("/api/auth/2fa/setup",{method:"POST",headers:{Authorization:"Bearer ".concat(e)},body:JSON.stringify({user_id:t.id,account_name:t.email})})}async verify2FASetup(e){const t=this.getToken(),r=this.getCurrentUser();if(!r&&!e.user_id)throw new Error("User ID required for 2FA verification");return this.request("/api/auth/2fa/verify",{method:"POST",headers:{Authorization:"Bearer ".concat(t)},body:JSON.stringify({user_id:e.user_id||(null===r||void 0===r?void 0:r.id),code:e.code,is_backup_code:e.is_backup_code||!1})})}async verify2FALogin(e){return this.request("/api/auth/2fa/verify-login",{method:"POST",body:JSON.stringify({user_id:e.user_id,code:e.code,is_backup_code:e.is_backup_code||!1,temp_token:e.temp_token})})}async enable2FA(e){const t=this.getCurrentUser();if(!t)throw new Error("User not authenticated");const r=this.getToken();return this.request("/api/auth/2fa/enable",{method:"POST",headers:{Authorization:"Bearer ".concat(r)},body:JSON.stringify({user_id:t.id,code:e})})}async disable2FA(){const e=this.getCurrentUser();if(!e)throw new Error("User not authenticated");const t=this.getToken();return this.request("/api/auth/2fa/disable",{method:"POST",headers:{Authorization:"Bearer ".concat(t)},body:JSON.stringify({user_id:e.id})})}async get2FAStatus(){const e=this.getCurrentUser();if(!e)throw new Error("User not authenticated");const t=this.getToken(),r=await this.request("/api/auth/2fa/status?user_id="+e.id,{method:"GET",headers:{Authorization:"Bearer ".concat(t)}});return{enabled:r.enabled,backup_codes_remaining:0,setup:r.setup,setup_at:r.setup_at,last_used:r.last_used}}async generateBackupCodes(){const e=this.getCurrentUser();if(!e)throw new Error("User not authenticated");const t=this.getToken();return this.request("/api/auth/2fa/backup-codes",{method:"POST",headers:{Authorization:"Bearer ".concat(t)},body:JSON.stringify({user_id:e.id})})}setTempToken(e){localStorage.setItem("tempToken",e)}getTempToken(){return localStorage.getItem("tempToken")}removeTempToken(){localStorage.removeItem("tempToken")}}},60345:function(e,t,r){"use strict";r.d(t,{cn:function(){return o}});var n=r(50348),s=r(23986);function o(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.m)((0,n.W)(t))}},58960:function(e){!function(){var t={229:function(e){var t,r,n=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(e){if(t===setTimeout)return setTimeout(e,0);if((t===s||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"===typeof setTimeout?setTimeout:s}catch(e){t=s}try{r="function"===typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var i,c=[],u=!1,d=-1;function l(){u&&i&&(u=!1,i.length?c=i.concat(c):d=-1,c.length&&f())}function f(){if(!u){var e=a(l);u=!0;for(var t=c.length;t;){for(i=c,c=[];++d<t;)i&&i[d].run();d=-1,t=c.length}i=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function m(){}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new h(e,t)),1!==c.length||u||a(f)},h.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=m,n.addListener=m,n.once=m,n.off=m,n.removeListener=m,n.removeAllListeners=m,n.emit=m,n.prependListener=m,n.prependOnceListener=m,n.listeners=function(e){return[]},n.binding=function(e){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}}},r={};function n(e){var s=r[e];if(void 0!==s)return s.exports;var o=r[e]={exports:{}},a=!0;try{t[e](o,o.exports,n),a=!1}finally{a&&delete r[e]}return o.exports}n.ab="//";var s=n(229);e.exports=s}()},24033:function(e,t,r){e.exports=r(50094)},36743:function(e,t,r){"use strict";r.d(t,{f:function(){return i}});var n=r(2265),s=r(9381),o=r(57437),a=n.forwardRef(((e,t)=>(0,o.jsx)(s.WV.label,{...e,ref:t,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}})));a.displayName="Label";var i=a},9381:function(e,t,r){"use strict";r.d(t,{WV:function(){return i},jH:function(){return c}});var n=r(2265),s=r(54887),o=r(67256),a=r(57437),i=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce(((e,t)=>{const r=(0,o.Z8)(`Primitive.${t}`),s=n.forwardRef(((e,n)=>{const{asChild:s,...o}=e,i=s?r:t;return"undefined"!==typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,a.jsx)(i,{...o,ref:n})}));return s.displayName=`Primitive.${t}`,{...e,[t]:s}}),{});function c(e,t){e&&s.flushSync((()=>e.dispatchEvent(t)))}}},function(e){e.O(0,[2649,6892,2971,2472,1744],(function(){return t=70337,e(e.s=t);var t}));var t=e.O();_N_E=t}]);