"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1623],{57116:function(e,t,r){r.d(t,{Z:function(){return u}});var n=r(57437),o=r(2265),s=r(24033),a=r(16746),i=r(87258);function u(e){let{children:t,requireAuth:r=!0,redirectTo:u="/auth/login"}=e;const{isAuthenticated:c,isLoading:d,requires2FA:l}=(0,a.useAuth)(),h=(0,s.useRouter)(),f=(0,s.usePathname)();return(0,o.useEffect)((()=>{if(d)return;const e=["/auth/login","/auth/register","/auth/forgot-password","/auth/reset-password"].some((e=>f.startsWith(e)));!r||c||l||e?c&&e?h.push("/dashboard"):!l||f.startsWith("/auth/")||h.push("/auth/login"):h.push(u)}),[c,d,l,f,h,r,u]),d?(0,n.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(i.P.spinner,{className:"h-6 w-6 animate-spin"}),(0,n.jsx)("span",{className:"text-muted-foreground",children:"Loading..."})]})}):!r||c||l?(0,n.jsx)(n.Fragment,{children:t}):null}},40150:function(e,t,r){r.d(t,{C:function(){return i}});var n=r(57437),o=(r(2265),r(96061)),s=r(60345);const a=(0,o.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:r,...o}=e;return(0,n.jsx)("div",{className:(0,s.cn)(a({variant:r}),t),...o})}},3089:function(e,t,r){r.d(t,{z:function(){return c}});var n=r(57437),o=r(2265),s=r(67256),a=r(96061),i=r(60345);const u=(0,a.j)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 active:scale-95",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-sm hover:shadow-md",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 shadow-sm hover:shadow-md",success:"bg-success text-success-foreground hover:bg-success/90 shadow-sm hover:shadow-md",warning:"bg-warning text-warning-foreground hover:bg-warning/90 shadow-sm hover:shadow-md",info:"bg-info text-info-foreground hover:bg-info/90 shadow-sm hover:shadow-md",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground hover:border-accent-foreground/20",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 shadow-sm",ghost:"hover:bg-accent hover:text-accent-foreground hover:scale-105",link:"text-primary underline-offset-4 hover:underline hover:text-primary/80",nova:"bg-gradient-to-r from-nova-500 to-nova-600 text-white hover:from-nova-600 hover:to-nova-700 shadow-md hover:shadow-lg"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=o.forwardRef(((e,t)=>{let{className:r,variant:o,size:a,asChild:c=!1,...d}=e;const l=c?s.g7:"button";return(0,n.jsx)(l,{className:(0,i.cn)(u({variant:o,size:a,className:r})),ref:t,...d})}));c.displayName="Button"},10609:function(e,t,r){r.d(t,{Ol:function(){return i},SZ:function(){return c},Zb:function(){return a},aY:function(){return d},eW:function(){return l},ll:function(){return u}});var n=r(57437),o=r(2265),s=r(60345);const a=o.forwardRef(((e,t)=>{let{className:r,...o}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...o})}));a.displayName="Card";const i=o.forwardRef(((e,t)=>{let{className:r,...o}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",r),...o})}));i.displayName="CardHeader";const u=o.forwardRef(((e,t)=>{let{className:r,...o}=e;return(0,n.jsx)("h3",{ref:t,className:(0,s.cn)("text-2xl font-semibold leading-none tracking-tight",r),...o})}));u.displayName="CardTitle";const c=o.forwardRef(((e,t)=>{let{className:r,...o}=e;return(0,n.jsx)("p",{ref:t,className:(0,s.cn)("text-sm text-muted-foreground",r),...o})}));c.displayName="CardDescription";const d=o.forwardRef(((e,t)=>{let{className:r,...o}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("p-6 pt-0",r),...o})}));d.displayName="CardContent";const l=o.forwardRef(((e,t)=>{let{className:r,...o}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("flex items-center p-6 pt-0",r),...o})}));l.displayName="CardFooter"},87258:function(e,t,r){r.d(t,{P:function(){return A}});var n=r(86264),o=r(81291),s=r(17158),a=r(62442),i=r(82549),u=r(11981),c=r(74056),d=r(13008),l=r(82104),h=r(99670),f=r(77216),g=r(49036),m=r(36678),p=r(5589),v=r(1295),y=r(67972),b=r(25750),w=r(12741),k=r(22812),T=r(73067),x=r(68291),_=r(20173),N=r(28203),S=r(6141),O=r(92851);const A={spinner:n.Z,chevronLeft:o.Z,chevronRight:s.Z,check:a.Z,cross:i.Z,warning:u.Z,info:c.Z,success:d.Z,error:l.Z,eye:h.Z,eyeOff:f.Z,shield:g.Z,shieldCheck:m.Z,lock:p.Z,mail:v.Z,user:y.Z,users:b.Z,phone:w.Z,building:k.Z,arrowLeft:T.Z,arrowRight:x.Z,checkCircle2:_.Z,calendar:N.Z,clock:S.Z,sparkles:O.Z}},16746:function(e,t,r){r.r(t),r.d(t,{AuthProvider:function(){return u},useAuth:function(){return c}});var n=r(57437),o=r(2265),s=r(24033),a=r(50471);const i=(0,o.createContext)(void 0);function u(e){let{children:t}=e;const[r,u]=(0,o.useState)(null),[c,d]=(0,o.useState)(!0),[l,h]=(0,o.useState)(!1),[f,g]=(0,o.useState)(null),m=(0,s.useRouter)();(0,o.useEffect)((()=>{const e=a.O.getToken(),t=a.O.getTempToken();if(e){const e=a.O.getCurrentUser();u(e)}else t&&(g(t),h(!0));d(!1)}),[]);return(0,n.jsx)(i.Provider,{value:{user:r,isLoading:c,isAuthenticated:!!r,requires2FA:l,tempToken:f,login:async(e,t)=>{try{const r=await a.O.login({email:e,password:t});r.requires_2fa&&r.temp_token?(a.O.setTempToken(r.temp_token),g(r.temp_token),h(!0)):(a.O.setToken(r.token,r.user),u(r.user),h(!1),g(null))}catch(r){throw console.error("Login failed:",r),r}},logout:()=>{a.O.logout(),u(null),h(!1),g(null),m.push("/auth/login")},verify2FA:async e=>{if(!f)throw new Error("No temporary token available");try{const t=await a.O.verify2FALogin({code:e,temp_token:f});a.O.setToken(t.token,t.user),a.O.removeTempToken(),u(t.user),h(!1),g(null)}catch(t){throw console.error("2FA verification failed:",t),t}}},children:t})}function c(){const e=(0,o.useContext)(i);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e}},50471:function(e,t,r){r.d(t,{O:function(){return o}});const n=r(62601).env.NEXT_PUBLIC_API_URL||"http://localhost:8090";const o=new class{async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r="".concat(n).concat(e),o={headers:{"Content-Type":"application/json",...t.headers},...t};try{const e=await fetch(r,o);if(!e.ok)throw new Error("HTTP error! status: ".concat(e.status));return await e.json()}catch(s){throw console.error("API request failed for ".concat(e,":"),s),s}}async login(e){return this.request("/api/auth/login",{method:"POST",body:JSON.stringify(e)})}async register(e){return this.request("/api/auth/register",{method:"POST",body:JSON.stringify(e)})}async forgotPassword(e){return this.request("/api/auth/forgot-password",{method:"POST",body:JSON.stringify(e)})}async resetPassword(e){return this.request("/api/auth/reset-password",{method:"POST",body:JSON.stringify(e)})}decodeJWT(e){try{const t=e.split(".");if(3!==t.length)throw new Error("Invalid JWT format");const r=t[1],n=atob(r.replace(/-/g,"+").replace(/_/g,"/"));return JSON.parse(n)}catch(t){return console.error("Failed to decode JWT:",t),null}}getCurrentUser(){const e=this.getToken();if(!e)return null;try{const t=this.decodeJWT(e);if(!t)return this.removeToken(),null;if(t.exp&&1e3*t.exp<Date.now())return this.removeToken(),null;const r={id:t.sub||t.user_id||t.id,email:t.email||"",firstName:t.firstName||t.first_name||t.given_name||"",lastName:t.lastName||t.last_name||t.family_name||"",tenantId:t.tenantId||t.tenant_id,status:t.status||"active",two_factor_enabled:t.two_factor_enabled||t["2fa_enabled"]||!1};return localStorage.setItem("authUser",JSON.stringify(r)),r}catch(t){return console.error("Error getting current user:",t),this.removeToken(),null}}isAuthenticated(){return!!this.getToken()}getToken(){return localStorage.getItem("novacron_token")}setToken(e,t){localStorage.setItem("novacron_token",e),t&&localStorage.setItem("authUser",JSON.stringify(t))}removeToken(){localStorage.removeItem("novacron_token"),localStorage.removeItem("authUser"),localStorage.removeItem("tempToken")}logout(){this.removeToken()}async setup2FA(){const e=this.getToken(),t=this.getCurrentUser();if(!t)throw new Error("User not authenticated");return this.request("/api/auth/2fa/setup",{method:"POST",headers:{Authorization:"Bearer ".concat(e)},body:JSON.stringify({user_id:t.id,account_name:t.email})})}async verify2FASetup(e){const t=this.getToken(),r=this.getCurrentUser();if(!r&&!e.user_id)throw new Error("User ID required for 2FA verification");return this.request("/api/auth/2fa/verify",{method:"POST",headers:{Authorization:"Bearer ".concat(t)},body:JSON.stringify({user_id:e.user_id||(null===r||void 0===r?void 0:r.id),code:e.code,is_backup_code:e.is_backup_code||!1})})}async verify2FALogin(e){return this.request("/api/auth/2fa/verify-login",{method:"POST",body:JSON.stringify({user_id:e.user_id,code:e.code,is_backup_code:e.is_backup_code||!1,temp_token:e.temp_token})})}async enable2FA(e){const t=this.getCurrentUser();if(!t)throw new Error("User not authenticated");const r=this.getToken();return this.request("/api/auth/2fa/enable",{method:"POST",headers:{Authorization:"Bearer ".concat(r)},body:JSON.stringify({user_id:t.id,code:e})})}async disable2FA(){const e=this.getCurrentUser();if(!e)throw new Error("User not authenticated");const t=this.getToken();return this.request("/api/auth/2fa/disable",{method:"POST",headers:{Authorization:"Bearer ".concat(t)},body:JSON.stringify({user_id:e.id})})}async get2FAStatus(){const e=this.getCurrentUser();if(!e)throw new Error("User not authenticated");const t=this.getToken(),r=await this.request("/api/auth/2fa/status?user_id="+e.id,{method:"GET",headers:{Authorization:"Bearer ".concat(t)}});return{enabled:r.enabled,backup_codes_remaining:0,setup:r.setup,setup_at:r.setup_at,last_used:r.last_used}}async generateBackupCodes(){const e=this.getCurrentUser();if(!e)throw new Error("User not authenticated");const t=this.getToken();return this.request("/api/auth/2fa/backup-codes",{method:"POST",headers:{Authorization:"Bearer ".concat(t)},body:JSON.stringify({user_id:e.id})})}setTempToken(e){localStorage.setItem("tempToken",e)}getTempToken(){return localStorage.getItem("tempToken")}removeTempToken(){localStorage.removeItem("tempToken")}}},60345:function(e,t,r){r.d(t,{cn:function(){return s}});var n=r(50348),o=r(23986);function s(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,o.m)((0,n.W)(t))}}}]);