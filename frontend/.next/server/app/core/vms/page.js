(()=>{var e={id:8465,ids:[8465]};e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},2262:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.ZP,__next_app__:()=>u,originalPathname:()=>c,pages:()=>d,routeModule:()=>m,tree:()=>l});var r=s(7096),a=s(6132),n=s(8658),i=s(2564),o={};for(const p in i)["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(p)<0&&(o[p]=()=>i[p]);s.d(t,o);const l=["",{children:["core",{children:["vms",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,3783)),"/home/kp/novacron/frontend/src/app/core/vms/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,6771)),"/home/kp/novacron/frontend/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,9291,23)),"next/dist/client/components/not-found-error"]}],d=["/home/kp/novacron/frontend/src/app/core/vms/page.tsx"],c="/core/vms/page",u={require:s,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/core/vms/page",pathname:"/core/vms",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},8057:(e,t,s)=>{Promise.resolve().then(s.bind(s,1024))},1024:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>S,dynamic:()=>y});var r=s(784),a=s(9885),n=s(6936),i=s(2417);async function o(e,t,s){return(0,i.cD)(e,t,{role:s})}var l=s(212),d=s(12),c=s(7668),u=s(7505),m=s(7950),p=s(6589),x=s(1440),g=s.n(x),h=s(7133),v=s(5304),j=s(7040),f=s(9748);const y="force-dynamic";function S(){const[e,t]=(0,a.useState)(""),[s,i]=(0,a.useState)(""),[x,y]=(0,a.useState)(null),[S,b]=(0,a.useState)("viewer"),[P,w]=(0,a.useState)(1),[N,k]=(0,a.useState)(10);(0,a.useEffect)((()=>{w(1)}),[e,s]);const{items:q,pagination:_,isLoading:E,error:C}=(0,n.v)({page:P,pageSize:N,q:e,state:s||void 0}),{toast:z}=(0,f.p)();(0,a.useEffect)((()=>{const e=(0,c.c)((e=>y(e)));return()=>e.close()}),[]),(0,a.useEffect)((()=>{try{const e=localStorage.getItem("coreRole");"viewer"!==e&&"operator"!==e||b(e)}catch{}}),[]),(0,a.useEffect)((()=>{try{localStorage.setItem("coreRole",S)}catch{}}),[S]);const M=e=>{switch(e){case"running":return"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400";case"stopped":default:return"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-400";case"paused":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400"}},L=(0,l.NL)(),R=(0,d.D)({mutationFn:e=>o(e,"start",S),onSuccess:async()=>{z({title:"Start requested",description:"VM start action submitted"}),await Promise.all([L.invalidateQueries({queryKey:["vms"]})])},onError:e=>{z({title:"Start failed",description:String(e?.message??e),variant:"destructive"})}}),A=(0,d.D)({mutationFn:e=>o(e,"stop",S),onSuccess:async()=>{z({title:"Stop requested",description:"VM stop action submitted"}),await Promise.all([L.invalidateQueries({queryKey:["vms"]})])},onError:e=>{z({title:"Stop failed",description:String(e?.message??e),variant:"destructive"})}}),V=(0,d.D)({mutationFn:e=>o(e,"restart",S),onSuccess:async()=>{z({title:"Restart requested",description:"VM restart action submitted"}),await Promise.all([L.invalidateQueries({queryKey:["vms"]})])},onError:e=>{z({title:"Restart failed",description:String(e?.message??e),variant:"destructive"})}}),Q=(0,d.D)({mutationFn:e=>o(e,"pause",S),onSuccess:async()=>{z({title:"Pause requested",description:"VM pause action submitted"}),await Promise.all([L.invalidateQueries({queryKey:["vms"]})])},onError:e=>{z({title:"Pause failed",description:String(e?.message??e),variant:"destructive"})}}),$=(0,d.D)({mutationFn:e=>o(e,"resume",S),onSuccess:async()=>{z({title:"Resume requested",description:"VM resume action submitted"}),await Promise.all([L.invalidateQueries({queryKey:["vms"]})])},onError:e=>{z({title:"Resume failed",description:String(e?.message??e),variant:"destructive"})}}),D="operator"!==S;return r.jsx("div",{className:"container mx-auto p-6 space-y-6",children:(0,r.jsxs)(j.Zb,{children:[(0,r.jsxs)(j.Ol,{children:[r.jsx(j.ll,{children:"Core VMs"}),(0,r.jsxs)(j.SZ,{children:[E?"Loading...":C?"Error loading":`${Array.isArray(q)?q.length:0} items`," "," ",x?`\u2014 WS welcome: ${JSON.stringify(x)}`:null]})]}),(0,r.jsxs)(j.aY,{children:[(0,r.jsxs)("div",{className:"flex flex-wrap gap-3 mb-3 items-center",children:[r.jsx(u.I,{placeholder:"Search (q)",value:e,onChange:e=>t(e.target.value),className:"w-64"}),(0,r.jsxs)(m.Ph,{value:s,onValueChange:i,children:[r.jsx(m.i4,{className:"w-40",children:r.jsx(m.ki,{placeholder:"State"})}),(0,r.jsxs)(m.Bw,{children:[r.jsx(m.Ql,{value:"",children:"All"}),r.jsx(m.Ql,{value:"running",children:"Running"}),r.jsx(m.Ql,{value:"stopped",children:"Stopped"}),r.jsx(m.Ql,{value:"paused",children:"Paused"})]})]}),(0,r.jsxs)(m.Ph,{value:String(N),onValueChange:e=>k(Number(e)),children:[r.jsx(m.i4,{className:"w-32",children:r.jsx(m.ki,{placeholder:"Page size"})}),r.jsx(m.Bw,{children:[10,20,50,100].map((e=>(0,r.jsxs)(m.Ql,{value:String(e),children:[e," / page"]},e)))})]}),(0,r.jsxs)(m.Ph,{value:S,onValueChange:e=>b(e),children:[r.jsx(m.i4,{className:"w-40",children:r.jsx(m.ki,{placeholder:"Role"})}),(0,r.jsxs)(m.Bw,{children:[r.jsx(m.Ql,{value:"viewer",children:"viewer"}),r.jsx(m.Ql,{value:"operator",children:"operator"})]})]})]}),C?r.jsx("div",{className:"text-sm text-red-500",children:"Failed to load VMs"}):!q||0===q.length&&!E?r.jsx("div",{className:"text-sm text-muted-foreground",children:"No VMs found."}):(0,r.jsxs)(p.iA,{children:[r.jsx(p.xD,{children:(0,r.jsxs)(p.SC,{children:[r.jsx(p.ss,{children:"ID"}),r.jsx(p.ss,{children:"Name"}),r.jsx(p.ss,{children:"State"}),r.jsx(p.ss,{children:"Node"}),r.jsx(p.ss,{children:"Created"}),r.jsx(p.ss,{children:"Updated"}),r.jsx(p.ss,{className:"text-right",children:"Actions"})]})}),r.jsx(p.RM,{children:Array.isArray(q)&&q.map((e=>(0,r.jsxs)(p.SC,{children:[r.jsx(p.pj,{className:"font-mono text-xs",children:r.jsx(g(),{href:`/core/vms/${e.id}`,"aria-label":`View ${e.name} details`,className:"underline underline-offset-4",children:e.id})}),r.jsx(p.pj,{children:r.jsx(g(),{href:`/core/vms/${e.id}`,"aria-label":`View ${e.name} details`,className:"hover:underline",children:e.name})}),r.jsx(p.pj,{children:r.jsx(h.C,{className:M(e.state),children:e.state})}),r.jsx(p.pj,{children:e.node_id??"-"}),r.jsx(p.pj,{children:e.created_at}),r.jsx(p.pj,{children:e.updated_at}),(0,r.jsxs)(p.pj,{className:"text-right space-x-2",children:[r.jsx(v.z,{size:"sm",variant:"secondary",onClick:()=>R.mutate(e.id),disabled:D||R.isPending,children:"Start"}),r.jsx(v.z,{size:"sm",variant:"secondary",onClick:()=>A.mutate(e.id),disabled:D||A.isPending,children:"Stop"}),r.jsx(v.z,{size:"sm",variant:"secondary",onClick:()=>V.mutate(e.id),disabled:D||V.isPending,children:"Restart"}),r.jsx(v.z,{size:"sm",variant:"secondary",onClick:()=>Q.mutate(e.id),disabled:D||Q.isPending,children:"Pause"}),r.jsx(v.z,{size:"sm",variant:"secondary",onClick:()=>$.mutate(e.id),disabled:D||$.isPending,children:"Resume"})]})]},e.id)))})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between mt-3",children:[(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:["page=",_?.page??P," pageSize=",_?.pageSize??N," total=",_?.total??"-"," totalPages=",_?.totalPages??"-"]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx(v.z,{size:"sm",variant:"outline",onClick:()=>w((e=>Math.max(1,e-1))),disabled:E||(_?.page??P)<=1,children:"Prev"}),r.jsx(v.z,{size:"sm",variant:"outline",onClick:()=>w((e=>e+1)),disabled:E||!(!_||!_.totalPages)&&_.page>=_.totalPages,children:"Next"})]})]})]})]})})}},7505:(e,t,s)=>{"use strict";s.d(t,{I:()=>i});var r=s(784),a=s(9885),n=s(467);const i=a.forwardRef((({className:e,type:t,...s},a)=>r.jsx("input",{type:t,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:a,...s})));i.displayName="Input"},6936:(e,t,s)=>{"use strict";s.d(t,{v:()=>n});var r=s(3993),a=s(2417);function n(e){const{data:t,isLoading:s,error:n}=(0,r.a)({queryKey:["vms",e],queryFn:()=>(0,a.tq)(e),staleTime:5e3});return{items:Array.isArray(t?.data)?t.data:[],pagination:t?.pagination||{page:1,pageSize:10,total:0,totalPages:0},isLoading:s,error:n}}},7668:(e,t,s)=>{"use strict";s.d(t,{c:()=>a});const r=process.env.NEXT_PUBLIC_WS_URL||"ws://localhost:8090/ws/events/v1";function a(e){try{const t=new WebSocket(r);let s=!0;return t.addEventListener("open",(()=>console.log("WS connected"))),t.addEventListener("error",(e=>console.warn("WS error:",e))),t.addEventListener("close",(()=>console.log("WS disconnected"))),t.addEventListener("message",(t=>{try{const r=JSON.parse(t.data);s&&(s=!1,e?.(r))}catch(r){}})),t}catch(t){return{close:()=>{},addEventListener:()=>{},removeEventListener:()=>{},send:()=>{},readyState:WebSocket.CLOSED}}}},3783:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>n,__esModule:()=>a,default:()=>l,dynamic:()=>o});const r=(0,s(5153).createProxy)(String.raw`/home/kp/novacron/frontend/src/app/core/vms/page.tsx`),{__esModule:a,$$typeof:n}=r,i=r.default,o=r.dynamic,l=i}};var t=require("../../../webpack-runtime.js");t.C(e);var s=t.X(0,[1076,1425,1264,5560,1440,3993,12,5603,3215,4975,7950,7133,6589,9748,2417],(()=>{return e=2262,t(t.s=e);var e}));module.exports=s})();