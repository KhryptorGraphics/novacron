(()=>{var e={id:8352,ids:[8352]};e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},23718:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>d,routeModule:()=>h,tree:()=>l});var r=s(67096),a=s(16132),n=s(37284),i=s.n(n),o=s(32564),c={};for(const x in o)["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(x)<0&&(c[x]=()=>o[x]);s.d(t,c);const l=["",{children:["auth",{children:["setup-2fa",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,59552)),"/home/kp/novacron/frontend/src/app/auth/setup-2fa/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,62417)),"/home/kp/novacron/frontend/src/app/auth/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,89200)),"/home/kp/novacron/frontend/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,9291,23)),"next/dist/client/components/not-found-error"]}],d=["/home/kp/novacron/frontend/src/app/auth/setup-2fa/page.tsx"],u="/auth/setup-2fa/page",p={require:s,loadChunk:()=>Promise.resolve()},h=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/auth/setup-2fa/page",pathname:"/auth/setup-2fa",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},96038:(e,t,s)=>{Promise.resolve().then(s.bind(s,34004))},34004:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>x});var r=s(30784),a=s(9885),n=s(11440),i=s.n(n),o=s(57114),c=s(45304),l=s(57505),d=s(37565),u=s(97040),p=s(99748),h=s(7803);function x(){const[e,t]=(0,a.useState)("setup"),[s,n]=(0,a.useState)(!1),[x,m]=(0,a.useState)(!0),[f,j]=(0,a.useState)(""),[g,v]=(0,a.useState)(null),[y,b]=(0,a.useState)(""),[P,N]=(0,a.useState)(""),[w,_]=(0,a.useState)([]),S=(0,o.useRouter)(),{toast:k}=(0,p.p)();(0,a.useEffect)((()=>{(async()=>{try{if(!h.O.isAuthenticated())return void S.push("/auth/login");m(!0);const e=await h.O.setup2FA();b(e.qr_code),N(e.secret),_(e.backup_codes)}catch(g){console.error("Failed to initialize 2FA setup:",g),k({title:"Error",description:"Failed to initialize 2FA setup. Please try again.",variant:"destructive"}),b("https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=otpauth://totp/NovaCron:user@example.com?secret=JBSWY3DPEHPK3PXP&issuer=NovaCron"),N("JBSWY3DPEHPK3PXP"),_(["1a2b-3c4d","5e6f-7g8h","9i0j-1k2l","3m4n-5o6p","7q8r-9s0t","1u2v-3w4x"])}finally{m(!1)}})()}),[S,k]);return r.jsx("div",{className:"container relative min-h-screen flex-col items-center justify-center grid lg:max-w-none lg:px-0",children:(0,r.jsxs)("div",{className:"mx-auto flex w-full flex-col justify-center space-y-6 sm:w-[480px]",children:[r.jsx("div",{className:"flex justify-center mb-4",children:r.jsx(i(),{href:"/dashboard",className:"flex items-center gap-2 text-sm text-gray-600 hover:text-gray-900",children:"\u2190 Skip to Dashboard"})}),"setup"===e&&(0,r.jsxs)(u.Zb,{children:[(0,r.jsxs)(u.Ol,{children:[r.jsx(u.ll,{children:"Set Up Two-Factor Authentication"}),r.jsx(u.SZ,{children:"Scan the QR code with your authenticator app"})]}),(0,r.jsxs)(u.aY,{className:"space-y-4",children:[x?r.jsx("div",{className:"flex justify-center py-8",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})}):(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"flex justify-center",children:r.jsx("img",{src:y,alt:"2FA QR Code",className:"w-48 h-48"})}),(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Or enter this code manually:"}),r.jsx("code",{className:"bg-gray-100 px-3 py-1 rounded",children:P})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[r.jsx(d._,{children:"Backup Codes"}),r.jsx("div",{className:"grid grid-cols-2 gap-2",children:w.map(((e,t)=>r.jsx("code",{className:"bg-gray-100 px-2 py-1 rounded text-sm",children:e},t)))})]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx(c.z,{onClick:()=>t("verify"),className:"flex-1",disabled:x,children:"Continue to Verification"}),r.jsx(c.z,{onClick:()=>{S.push("/dashboard")},variant:"outline",disabled:x,children:"Skip"})]})]})]}),"verify"===e&&(0,r.jsxs)(u.Zb,{children:[(0,r.jsxs)(u.Ol,{children:[r.jsx(u.ll,{children:"Verify Your Setup"}),r.jsx(u.SZ,{children:"Enter the 6-digit code from your authenticator app"})]}),r.jsx(u.aY,{children:(0,r.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),f&&6===f.length){n(!0),v(null);try{const e=h.O.getCurrentUser();if(!e)throw new Error("User not authenticated");const s=await h.O.verify2FASetup({user_id:e.id,code:f});if(!s.valid)throw new Error(s.error||"Verification failed");await h.O.enable2FA(f),t("complete"),k({title:"Two-Factor Authentication Enabled",description:"Your account is now secured with 2FA"})}catch(g){console.error("2FA verification failed:",g);const t=g instanceof Error?g.message:"Invalid verification code. Please try again.";v(t)}finally{n(!1)}}else v("Please enter a 6-digit verification code")},className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[r.jsx(d._,{htmlFor:"code",children:"Verification Code"}),r.jsx(l.I,{id:"code",type:"text",placeholder:"000000",value:f,onChange:e=>j(e.target.value),maxLength:6,disabled:s}),g&&r.jsx("p",{className:"text-sm text-red-600",children:g})]}),r.jsx(c.z,{type:"submit",className:"w-full",disabled:s,children:s?"Verifying...":"Verify and Enable 2FA"})]})})]}),"complete"===e&&(0,r.jsxs)(u.Zb,{children:[(0,r.jsxs)(u.Ol,{children:[r.jsx(u.ll,{children:"Setup Complete!"}),r.jsx(u.SZ,{children:"Two-factor authentication has been enabled for your account"})]}),r.jsx(u.aY,{children:(0,r.jsxs)("div",{className:"text-center space-y-4",children:[r.jsx("div",{className:"text-green-600 text-6xl",children:"\u2713"}),r.jsx("p",{children:"Your account is now more secure"}),r.jsx(c.z,{onClick:()=>{S.push("/dashboard")},className:"w-full",children:"Continue to Dashboard"})]})})]})]})})}},59552:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>n,__esModule:()=>a,default:()=>i});const r=(0,s(95153).createProxy)(String.raw`/home/kp/novacron/frontend/src/app/auth/setup-2fa/page.tsx`),{__esModule:a,$$typeof:n}=r,i=r.default}};var t=require("../../../webpack-runtime.js");t.C(e);var s=t.X(0,[6723,1440,8209,1730,7040,9748,3207],(()=>{return e=23718,t(t.s=e);var e}));module.exports=s})();