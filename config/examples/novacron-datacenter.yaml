# NovaCron Configuration - Datacenter Mode
# High-performance datacenter deployment with RDMA support

environment: "datacenter"

system:
  log_level: "info"
  debug: false
  metrics_enabled: true

  # Resource requirements
  min_cpu: 8
  min_memory: 16GB
  min_disk: 500GB

security:
  enabled: true
  zero_trust: true
  mfa_required: true

  secrets:
    provider: "vault"
    vault_address: "https://vault.internal.example.com:8200"
    vault_token: "${VAULT_TOKEN}"
    vault_namespace: "novacron"

  encryption:
    algorithm: "aes-256-gcm"
    key_rotation: 90d
    enable_at_rest: true
    enable_in_transit: true

  authentication:
    provider: "oauth2"
    oauth2_endpoint: "https://auth.internal.example.com"
    oauth2_client_id: "${OAUTH2_CLIENT_ID}"
    oauth2_client_secret: "${OAUTH2_CLIENT_SECRET}"

database:
  type: "postgresql"
  host: "db.internal.example.com"
  port: 5432
  name: "novacron"
  user: "${DB_USER}"
  password: "${DB_PASSWORD}"
  ssl_mode: "require"

  pool:
    min_connections: 10
    max_connections: 100
    connection_timeout: 30s
    idle_timeout: 10m
    max_lifetime: 1h

  migrations:
    enabled: true
    auto_migrate: true
    migration_path: "/etc/novacron/migrations"

cache:
  type: "redis"
  mode: "cluster"
  nodes:
    - "redis-1.internal.example.com:6379"
    - "redis-2.internal.example.com:6379"
    - "redis-3.internal.example.com:6379"
  password: "${REDIS_PASSWORD}"

  settings:
    ttl: 1h
    max_memory: 8GB
    eviction_policy: "allkeys-lru"

network:
  listen_address: "0.0.0.0"
  listen_port: 8080

  tls:
    enabled: true
    cert_file: "/etc/novacron/certs/server.crt"
    key_file: "/etc/novacron/certs/server.key"
    ca_file: "/etc/novacron/certs/ca.crt"
    min_version: "1.3"

dwcp:
  enabled: true
  version: "v3"
  mode: "datacenter"

  transport:
    min_streams: 32
    max_streams: 512
    initial_streams: 64
    stream_scaling_factor: 2.0
    congestion_algorithm: "bbr"
    enable_ecn: true
    send_buffer_size: 32MB
    recv_buffer_size: 32MB
    connect_timeout: 10s
    read_timeout: 30s
    write_timeout: 30s

    # RDMA support for datacenter
    enable_rdma: true
    rdma_device: "mlx5_0"
    rdma_port: 1

    # Packet pacing
    enable_pacing: true
    pacing_rate: 10GB  # 10 Gbps

  compression:
    enabled: true
    algorithm: "zstd"
    level: "high_performance"  # Datacenter has CPU to spare
    enable_delta_encoding: true
    baseline_interval: 5m
    max_delta_chain: 10
    delta_algorithm: "xor"  # Fast for datacenter
    enable_dictionary: true
    dictionary_update_interval: 24h
    enable_adaptive: true
    adaptive_threshold: 15.0
    min_compression_ratio: 1.5  # Expect good ratios in datacenter
    enable_baseline_sync: true
    baseline_sync_interval: 5s
    enable_pruning: true
    pruning_interval: 10m

  prediction:
    enabled: true
    model_type: "lstm"
    prediction_horizon: 5m
    update_interval: 30s
    history_window: 1h
    confidence_level: 0.95

  sync:
    enabled: true
    sync_interval: 100ms  # Fast sync in datacenter
    max_staleness: 500ms
    conflict_resolution: "mvcc"  # Strong consistency
    enable_versioning: true

  consensus:
    enabled: true
    algorithm: "raft"  # Raft for datacenter
    quorum_size: 3
    election_timeout: 150ms
    heartbeat_interval: 50ms
    adaptive_mode: false  # Fixed configuration in datacenter

api:
  version: "v1"
  base_path: "/api/v1"

  rate_limit:
    enabled: true
    requests_per_minute: 10000  # High rate limit for datacenter
    burst: 1000

  cors:
    enabled: true
    allowed_origins:
      - "https://console.internal.example.com"
      - "https://dashboard.internal.example.com"
    allowed_methods:
      - "GET"
      - "POST"
      - "PUT"
      - "DELETE"
      - "PATCH"
    allowed_headers:
      - "Authorization"
      - "Content-Type"

monitoring:
  enabled: true

  metrics:
    provider: "prometheus"
    port: 9090
    path: "/metrics"
    scrape_interval: 15s

  tracing:
    enabled: true
    provider: "jaeger"
    endpoint: "http://jaeger.internal.example.com:14268/api/traces"
    sampling_rate: 0.1  # 10% sampling

  logging:
    format: "json"
    output: "stdout"
    level: "info"

orchestration:
  enabled: true
  max_agents: 16
  topology: "mesh"
  enable_neural: true
  neural_target_accuracy: 0.98

ml:
  enabled: true

  models:
    bandwidth_predictor:
      type: "lstm"
      path: "/var/novacron/models/bandwidth_predictor.h5"
      update_interval: 1h

    task_scheduler:
      type: "dqn"
      path: "/var/novacron/models/task_scheduler.h5"
      update_interval: 1h

  training:
    enabled: true
    batch_size: 128
    epochs: 100
    validation_split: 0.2
