# NovaCron Configuration - Internet Mode
# Internet-scale deployment with Byzantine fault tolerance

environment: "internet"

system:
  log_level: "info"
  debug: false
  metrics_enabled: true

  # Resource requirements (lower for internet nodes)
  min_cpu: 4
  min_memory: 8GB
  min_disk: 100GB

security:
  enabled: true
  zero_trust: true
  mfa_required: true

  secrets:
    provider: "file"  # Local file storage for internet nodes
    secrets_path: "/etc/novacron/secrets"

  encryption:
    algorithm: "aes-256-gcm"
    key_rotation: 30d  # More frequent rotation for internet
    enable_at_rest: true
    enable_in_transit: true

  authentication:
    provider: "oauth2"
    oauth2_endpoint: "https://auth.novacron.io"
    oauth2_client_id: "${OAUTH2_CLIENT_ID}"
    oauth2_client_secret: "${OAUTH2_CLIENT_SECRET}"

database:
  type: "postgresql"
  host: "localhost"  # Local database for internet nodes
  port: 5432
  name: "novacron"
  user: "${DB_USER}"
  password: "${DB_PASSWORD}"
  ssl_mode: "require"

  pool:
    min_connections: 5
    max_connections: 25
    connection_timeout: 30s
    idle_timeout: 5m
    max_lifetime: 30m

cache:
  type: "redis"
  mode: "standalone"
  host: "localhost"
  port: 6379
  password: "${REDIS_PASSWORD}"

  settings:
    ttl: 30m
    max_memory: 2GB
    eviction_policy: "allkeys-lru"

network:
  listen_address: "0.0.0.0"
  listen_port: 8080

  tls:
    enabled: true
    cert_file: "/etc/novacron/certs/server.crt"
    key_file: "/etc/novacron/certs/server.key"
    min_version: "1.3"

dwcp:
  enabled: true
  version: "v3"
  mode: "internet"

  transport:
    min_streams: 16
    max_streams: 256
    initial_streams: 32
    stream_scaling_factor: 1.5
    congestion_algorithm: "bbr"
    enable_ecn: true
    send_buffer_size: 16MB
    recv_buffer_size: 16MB
    connect_timeout: 30s
    read_timeout: 60s
    write_timeout: 60s

    # No RDMA for internet
    enable_rdma: false

    # Packet pacing for gigabit internet
    enable_pacing: true
    pacing_rate: 900MB  # 900 Mbps (conservative for gigabit)

  compression:
    enabled: true
    algorithm: "zstd"
    level: "balanced"  # Balance CPU and compression ratio
    enable_delta_encoding: true
    baseline_interval: 5m
    max_delta_chain: 15
    delta_algorithm: "auto"  # Auto-select based on data
    enable_dictionary: true
    dictionary_update_interval: 24h
    enable_adaptive: true
    adaptive_threshold: 20.0  # Higher threshold for internet
    min_compression_ratio: 1.1
    enable_baseline_sync: true
    baseline_sync_interval: 10s
    enable_pruning: true
    pruning_interval: 15m

  prediction:
    enabled: true
    model_type: "lstm"
    prediction_horizon: 5m
    update_interval: 60s  # Less frequent on internet
    history_window: 2h
    confidence_level: 0.90  # Lower confidence for variable internet

  sync:
    enabled: true
    sync_interval: 5s  # Slower sync for internet
    max_staleness: 30s  # Tolerate more staleness
    conflict_resolution: "crdt"  # CRDT for eventual consistency
    enable_versioning: true

  consensus:
    enabled: true
    algorithm: "byzantine"  # PBFT for untrusted internet nodes
    quorum_size: 7  # Byzantine: f=2, n=3f+1=7
    election_timeout: 5s
    heartbeat_interval: 2s
    adaptive_mode: true  # Adapt to network conditions

api:
  version: "v1"
  base_path: "/api/v1"

  rate_limit:
    enabled: true
    requests_per_minute: 1000
    burst: 100

  cors:
    enabled: true
    allowed_origins:
      - "https://console.novacron.io"
      - "https://dashboard.novacron.io"
    allowed_methods:
      - "GET"
      - "POST"
      - "PUT"
      - "DELETE"
    allowed_headers:
      - "Authorization"
      - "Content-Type"

monitoring:
  enabled: true

  metrics:
    provider: "prometheus"
    port: 9090
    path: "/metrics"
    scrape_interval: 30s

  tracing:
    enabled: true
    provider: "jaeger"
    endpoint: "http://localhost:14268/api/traces"
    sampling_rate: 0.01  # 1% sampling for internet

  logging:
    format: "json"
    output: "stdout"
    level: "info"

orchestration:
  enabled: true
  max_agents: 8
  topology: "adaptive"  # Adapt to changing internet conditions
  enable_neural: true
  neural_target_accuracy: 0.95

ml:
  enabled: true

  models:
    bandwidth_predictor:
      type: "lstm"
      path: "/var/novacron/models/bandwidth_predictor.h5"
      update_interval: 4h  # Less frequent on internet

    task_scheduler:
      type: "dqn"
      path: "/var/novacron/models/task_scheduler.h5"
      update_interval: 4h

  training:
    enabled: false  # Disable training on internet nodes (resource constrained)
